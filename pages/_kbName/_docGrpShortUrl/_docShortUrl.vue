<template>
  <div>
    <el-container>
      <el-header>
        <el-menu class="el-menu-demo" mode="horizontal">
          <el-menu-item index="1">处理中心</el-menu-item>
          <el-submenu index="2">
            <template slot="title">我的工作台</template>
            <el-menu-item index="2-1">选项1</el-menu-item>
            <el-menu-item index="2-2">选项2</el-menu-item>
            <el-menu-item index="2-3">选项3</el-menu-item>
            <el-submenu index="2-4">
              <template slot="title">选项4</template>
              <el-menu-item index="2-4-1">选项1</el-menu-item>
              <el-menu-item index="2-4-2">选项2</el-menu-item>
              <el-menu-item index="2-4-3">选项3</el-menu-item>
            </el-submenu>
          </el-submenu>
          <el-menu-item index="3" disabled>消息中心</el-menu-item>
          <el-menu-item index="4"><a href="https://www.ele.me" target="_blank">订单管理</a></el-menu-item>
        </el-menu>
      </el-header>
      <el-container>
        <el-aside style="height: calc(100vh - .29524rem);">
          <el-tag>
            目录
          </el-tag>
          <el-tree :data="docInfo" :props="defaultProps"
                   @node-click="handleNodeClick"
                   :default-expand-all="true"
                   node-key="url"
                   :current-node-key="$route.params.docShortUrl"
          >

          </el-tree>
        </el-aside>
        <el-container style="margin-right: 20%">
          <el-main>
            <div v-html="content" style="margin-left: 10%;margin-top: 10px"> </div>
          </el-main>
          <el-footer>
            <div>
              <span style="display:block;text-align:center;"> footer</span>
            </div>
          </el-footer>
        </el-container>
      </el-container>
    </el-container>
  </div>
</template>

<script>
export default {
  name: "_docShortUrl",
  data() {
    return {
      content: "",
      kbInfo: {kbName: "", docGrpShortUrl: "", docShortUrl: ""},
      docInfo: [
        {
          label: '1',
          url: "1",
          children: [{
            label: '1.1',
            url: "1-1",
            children: [{
              label: '1.1.1',
              url: "1-1-1",
              children:
                [{
                  label: '1.1.1.1',
                  url: "1-1-1-1",
                }]
            }, {
              label: '1.1.2',
              url: "1-1-2",
            }]
          },
            {
              label: '1.2',
              url: "1-2",
            },]
        },
        {
          label: '2',
          url: "2",
          children: [{
            label: '2.1',
            url: "2-1",
          },
            {
              label: '2.2',
              url: "2-2",
            },]
        }
      ],
      defaultProps: {
        children: 'children',
        label: 'label'
      },
      contents: {
        qeaEre: '<!doctype lake><meta name="doc-version" content="1" /><meta name="viewport" content="fixed" /><meta name="typography" content="traditional" /><p data-lake-id="804b58e6d41ad7fb2480630c3092516e_p_3"><br /></p><h2 id="6492b052" data-lake-id="76f2c49bcf64d4c2861eab74da5e7f68_h2_0">0. go-zero介绍</h2><p data-lake-id="1f28059ccd62f1911b492ccbfa813e52_p_5">go-zero是一个集成了各种工程实践的web和rpc框架。通过弹性设计保障了大并发服务端的稳定性，经受了充分的实战检验。</p><p data-lake-id="f23fb9c519ff30bfe03d0b2cc2cac85d_p_6"><br /></p><p data-lake-id="f28c65b70302f81ff57912213f1e8e18_p_7">go-zero 包含极简的 API 定义和生成工具 goctl，可以根据定义的 api 文件一键生成 Go, iOS, Android, Kotlin, Dart, TypeScript, JavaScript 代码，并可直接运行。</p><p data-lake-id="92c8228235b93f7cc9ced6ac90fca3a6_p_8"><br /></p><p data-lake-id="d62972ae6152ecd39dd10dbd5148651f_p_9">使用go-zero的好处：</p><p data-lake-id="042da541aac17f869693ba89ebd10d8e_p_10"><br /></p><ul data-lake-id="56720f1a4a4c2ece5fee601a50e13b68_ul_0"><li data-lake-id="caadc7f50a3b772847779f2653a4b944_li_0">轻松获得支撑千万日活服务的稳定性</li></ul><ul data-lake-id="d2bf82f659a9f31bd35e0d8c48d76b5b_ul_1"><li data-lake-id="debca2d3ce9e685f393b8802db9dd234_li_1">内建级联超时控制、限流、自适应熔断、自适应降载等微服务治理能力，无需配置和额外代码</li></ul><ul data-lake-id="cfd8c6a610cb15433f3bbc17e07d61dd_ul_2"><li data-lake-id="4be11e977665e0554b44ea47f2283b71_li_2">微服务治理中间件可无缝集成到其它现有框架使用</li></ul><ul data-lake-id="522499a5a4b8b70b056805fb95f171ea_ul_3"><li data-lake-id="53324b63f21e934fde79f8bb15409605_li_3">极简的API描述，一键生成各端代码</li></ul><ul data-lake-id="47b6b07370a821160e09149038bf1b2e_ul_4"><li data-lake-id="1829c669eeb5149d38a00adcb68f27ec_li_4">自动校验客户端请求参数合法性</li><li data-lake-id="f142375b9fde8b9dc40149040c820af1_li_5">大量微服务治理和并发工具包</li></ul><p data-lake-id="2369fafe89fae403079018df6f36b51b_p_13"><card type="inline" name="image" value="data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2020%2Fpng%2F2623842%2F1601207386607-cb4ad2bb-d1e6-4f1d-83b3-50b69883b6fa.png%22%2C%22originWidth%22%3A2230%2C%22originHeight%22%3A1422%2C%22name%22%3A%22architecture.png%22%2C%22size%22%3A341219%2C%22display%22%3A%22inline%22%2C%22align%22%3A%22left%22%2C%22linkTarget%22%3A%22_blank%22%2C%22status%22%3A%22done%22%2C%22ocrLocations%22%3A%5B%7B%22x%22%3A571.9384%2C%22y%22%3A74.63848%2C%22width%22%3A78.12369999999999%2C%22height%22%3A41.38672%2C%22text%22%3A%22ios%22%7D%2C%7B%22x%22%3A1473.7816%2C%22y%22%3A76.38594%2C%22width%22%3A68.87940000000003%2C%22height%22%3A39.488339999999994%2C%22text%22%3A%22PC%22%7D%2C%7B%22x%22%3A865.82776%2C%22y%22%3A76.16111%2C%22width%22%3A87.80200000000002%2C%22height%22%3A42.26095600000001%2C%22text%22%3A%22%E5%AE%89%E5%8D%93%22%7D%2C%7B%22x%22%3A103.73665%2C%22y%22%3A85.84343%2C%22width%22%3A160.68885%2C%22height%22%3A57.07987999999999%2C%22text%22%3A%22%E5%AE%A2%E6%88%B7%E7%AB%AF%22%7D%2C%7B%22x%22%3A1167.7843%2C%22y%22%3A86.23478%2C%22width%22%3A81.65200000000004%2C%22height%22%3A30.533195000000006%2C%22text%22%3A%22web%22%7D%2C%7B%22x%22%3A292.8947%2C%22y%22%3A166.2572%2C%22width%22%3A1191.0986%2C%22height%22%3A31.038330000000002%2C%22text%22%3A%22...%22%7D%2C%7B%22x%22%3A1153.574%2C%22y%22%3A253.87595%2C%22width%22%3A134.1461999999999%2C%22height%22%3A45.039750000000026%2C%22text%22%3A%22%E5%8A%A0%E8%A7%A3%E5%AF%86%22%7D%2C%7B%22x%22%3A475.8904%2C%22y%22%3A253.91844%2C%22width%22%3A207.6336%2C%22height%22%3A46.090839999999986%2C%22text%22%3A%22HTTP%E5%8D%8F%E8%AE%AE%22%7D%2C%7B%22x%22%3A1457.6891%2C%22y%22%3A254.73956%2C%22width%22%3A172.48360000000002%2C%22height%22%3A44.993840000000006%2C%22text%22%3A%22%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95%22%7D%2C%7B%22x%22%3A854.69965%2C%22y%22%3A255.02759%2C%22width%22%3A90.99185%2C%22height%22%3A44.77563000000001%2C%22text%22%3A%22%E9%89%B4%E6%9D%83%22%7D%2C%7B%22x%22%3A106.77547%2C%22y%22%3A320.56628%2C%22width%22%3A130.67558000000002%2C%22height%22%3A47.48419999999999%2C%22text%22%3A%22API%E7%AB%AF%22%7D%2C%7B%22x%22%3A812.8882%2C%22y%22%3A362.12625%2C%22width%22%3A178.10860000000002%2C%22height%22%3A47.579589999999996%2C%22text%22%3A%22%E7%9B%91%E6%8E%A7%E6%8A%A5%E8%AD%A6%22%7D%2C%7B%22x%22%3A492.23923%2C%22y%22%3A362.32095%2C%22width%22%3A178.56142999999997%2C%22height%22%3A49.61200000000002%2C%22text%22%3A%22%E5%BC%82%E5%B8%B8%E6%8D%95%E8%8E%B7%22%7D%2C%7B%22x%22%3A1454.8314%2C%22y%22%3A362.7705%2C%22width%22%3A176.94010000000003%2C%22height%22%3A47.01389999999998%2C%22text%22%3A%22%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6%22%7D%2C%7B%22x%22%3A1135.0033%2C%22y%22%3A363.84848%2C%22width%22%3A175.067%2C%22height%22%3A47.127200000000016%2C%22text%22%3A%22%E6%95%B0%E6%8D%AE%E7%BB%9F%E8%AE%A1%22%7D%2C%7B%22x%22%3A492.39035%2C%22y%22%3A471.0723%2C%22width%22%3A179.94475%2C%22height%22%3A47.38313999999997%2C%22text%22%3A%22%E9%93%BE%E8%B7%AF%E8%B7%9F%E8%B8%AA%22%7D%2C%7B%22x%22%3A1455.0887%2C%22y%22%3A471.9534%2C%22width%22%3A182.09860000000003%2C%22height%22%3A51.234159999999974%2C%22text%22%3A%22%E8%87%AA%E5%8A%A8%E9%99%8D%E8%BD%BD%22%7D%2C%7B%22x%22%3A809.92554%2C%22y%22%3A472.89612%2C%22width%22%3A179.59416%2C%22height%22%3A47.180849999999964%2C%22text%22%3A%22%E8%B6%85%E6%97%B6%E6%8E%A7%E5%88%B6%22%7D%2C%7B%22x%22%3A1136.8615%2C%22y%22%3A473.01892%2C%22width%22%3A179.24569999999994%2C%22height%22%3A49.35487999999998%2C%22text%22%3A%22%E8%87%AA%E5%8A%A8%E7%86%94%E6%96%AD%22%7D%2C%7B%22x%22%3A1936.036%2C%22y%22%3A591.56885%2C%22width%22%3A184.96860000000015%2C%22height%22%3A48.93907999999999%2C%22text%22%3A%22%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0%22%7D%2C%7B%22x%22%3A1936.2506%2C%22y%22%3A643.72345%2C%22width%22%3A210.80939999999987%2C%22height%22%3A45.01565000000005%2C%22text%22%3A%22ETCD%E9%9B%86%E7%BE%A4%22%7D%2C%7B%22x%22%3A1129.67%2C%22y%22%3A648.2018%2C%22width%22%3A181.13940000000002%2C%22height%22%3A46.50909999999999%2C%22text%22%3A%22%E7%BC%93%E5%AD%98%E6%8E%A7%E5%88%B6%22%7D%2C%7B%22x%22%3A811.3904%2C%22y%22%3A648.8667%2C%22width%22%3A182.21182999999996%2C%22height%22%3A50.72344999999996%2C%22text%22%3A%22%E8%B0%83%E7%94%A8%E9%89%B4%E6%9D%83%22%7D%2C%7B%22x%22%3A1456.8091%2C%22y%22%3A652.432%2C%22width%22%3A173.38650000000007%2C%22height%22%3A45.02779999999996%2C%22text%22%3A%22%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95%22%7D%2C%7B%22x%22%3A478.5919%2C%22y%22%3A651.8933%2C%22width%22%3A208.05920000000003%2C%22height%22%3A49.190560000000005%2C%22text%22%3A%22gRPC%E5%8D%8F%E8%AE%AE%22%7D%2C%7B%22x%22%3A813.43634%2C%22y%22%3A757.2285%2C%22width%22%3A182.62486%2C%22height%22%3A51.0379999999999%2C%22text%22%3A%22%E7%9B%91%E6%8E%A7%E6%8A%A5%E8%AD%A6%22%7D%2C%7B%22x%22%3A1134.7034%2C%22y%22%3A760.07886%2C%22width%22%3A176.48209999999995%2C%22height%22%3A47.82904000000008%2C%22text%22%3A%22%E6%95%B0%E6%8D%AE%E7%BB%9F%E8%AE%A1%22%7D%2C%7B%22x%22%3A1453.8173%2C%22y%22%3A760.92664%2C%22width%22%3A182.93070000000012%2C%22height%22%3A47.25341000000003%2C%22text%22%3A%22%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6%22%7D%2C%7B%22x%22%3A493.16476%2C%22y%22%3A760.7551%2C%22width%22%3A182.16634%2C%22height%22%3A46.241499999999974%2C%22text%22%3A%22%E5%BC%82%E5%B8%B8%E6%8D%95%E8%8E%B7%22%7D%2C%7B%22x%22%3A55.504562%2C%22y%22%3A782.91003%2C%22width%22%3A221.718918%2C%22height%22%3A48.896870000000035%2C%22text%22%3A%22Service%E7%AB%AF%22%7D%2C%7B%22x%22%3A814.45746%2C%22y%22%3A869.6433%2C%22width%22%3A177.98184000000003%2C%22height%22%3A46.15943000000004%2C%22text%22%3A%22%E8%B6%85%E6%97%B6%E6%8E%A7%E5%88%B6%22%7D%2C%7B%22x%22%3A1142.0844%2C%22y%22%3A870.15375%2C%22width%22%3A170.86760000000004%2C%22height%22%3A45.897050000000036%2C%22text%22%3A%22%E8%87%AA%E5%8A%A8%E7%86%94%E6%96%AD%22%7D%2C%7B%22x%22%3A494.0421%2C%22y%22%3A870.67957%2C%22width%22%3A181.63685999999996%2C%22height%22%3A45.09762999999998%2C%22text%22%3A%22%E9%93%BE%E8%B7%AF%E8%B7%9F%E8%B8%AA%22%7D%2C%7B%22x%22%3A1460.7072%2C%22y%22%3A872.21%2C%22width%22%3A176.45090000000005%2C%22height%22%3A44.3125%2C%22text%22%3A%22%E8%87%AA%E5%8A%A8%E9%99%8D%E8%BD%BD%22%7D%2C%7B%22x%22%3A378.21707%2C%22y%22%3A945.05884%2C%22width%22%3A1083.26673%2C%22height%22%3A27.214290000000005%2C%22text%22%3A%22...%3F%3F%3F%3F%3F%3F%3F%3F%3F%3F%3F%3F%3F%3F%22%7D%2C%7B%22x%22%3A907.1511%2C%22y%22%3A1043.9534%2C%22width%22%3A206.4822999999999%2C%22height%22%3A46.519399999999905%2C%22text%22%3A%22Redis%E9%9B%86%E7%BE%A4%22%7D%2C%7B%22x%22%3A525.3871%2C%22y%22%3A1045.1276%2C%22width%22%3A201.06003999999996%2C%22height%22%3A43.88130000000001%2C%22text%22%3A%22Redis%E9%9B%86%E7%BE%A4%22%7D%2C%7B%22x%22%3A1296.7614%2C%22y%22%3A1045.3402%2C%22width%22%3A204.01639999999998%2C%22height%22%3A44.49499999999989%2C%22text%22%3A%22Redis%E9%9B%86%E7%BE%A4%22%7D%2C%7B%22x%22%3A81.05149%2C%22y%22%3A1048.9897%2C%22width%22%3A157.62051%2C%22height%22%3A51.13799999999992%2C%22text%22%3A%22%E7%BC%93%E5%AD%98%E5%B1%82%22%7D%2C%7B%22x%22%3A82.25081%2C%22y%22%3A1265.9808%2C%22width%22%3A158.68822%2C%22height%22%3A52.20069999999987%2C%22text%22%3A%22%E6%95%B0%E6%8D%AE%E5%BA%93%22%7D%2C%7B%22x%22%3A473.6402%2C%22y%22%3A1267.0819%2C%22width%22%3A237.46999999999997%2C%22height%22%3A47.32400000000007%2C%22text%22%3A%22MySQL%E9%9B%86%E7%BE%A4%22%7D%2C%7B%22x%22%3A906.1327%2C%22y%22%3A1266.6475%2C%22width%22%3A289.0445000000001%2C%22height%22%3A50.78489999999988%2C%22text%22%3A%22MongoDB%E9%9B%86%E7%BE%A4%22%7D%2C%7B%22x%22%3A1345.4462%2C%22y%22%3A1269.0502%2C%22width%22%3A309.0318%2C%22height%22%3A46.41610000000014%2C%22text%22%3A%22ClicKHouse%E9%9B%86%E7%BE%A4%22%7D%5D%2C%22style%22%3A%22none%22%2C%22search%22%3A%22ios%20PC%20%E5%AE%89%E5%8D%93%20%E5%AE%A2%E6%88%B7%E7%AB%AF%20web%20...%20%E5%8A%A0%E8%A7%A3%E5%AF%86%20HTTP%E5%8D%8F%E8%AE%AE%20%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95%20%E9%89%B4%E6%9D%83%20API%E7%AB%AF%20%E7%9B%91%E6%8E%A7%E6%8A%A5%E8%AD%A6%20%E5%BC%82%E5%B8%B8%E6%8D%95%E8%8E%B7%20%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6%20%E6%95%B0%E6%8D%AE%E7%BB%9F%E8%AE%A1%20%E9%93%BE%E8%B7%AF%E8%B7%9F%E8%B8%AA%20%E8%87%AA%E5%8A%A8%E9%99%8D%E8%BD%BD%20%E8%B6%85%E6%97%B6%E6%8E%A7%E5%88%B6%20%E8%87%AA%E5%8A%A8%E7%86%94%E6%96%AD%20%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0%20ETCD%E9%9B%86%E7%BE%A4%20%E7%BC%93%E5%AD%98%E6%8E%A7%E5%88%B6%20%E8%B0%83%E7%94%A8%E9%89%B4%E6%9D%83%20%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95%20gRPC%E5%8D%8F%E8%AE%AE%20%E7%9B%91%E6%8E%A7%E6%8A%A5%E8%AD%A6%20%E6%95%B0%E6%8D%AE%E7%BB%9F%E8%AE%A1%20%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6%20%E5%BC%82%E5%B8%B8%E6%8D%95%E8%8E%B7%20Service%E7%AB%AF%20%E8%B6%85%E6%97%B6%E6%8E%A7%E5%88%B6%20%E8%87%AA%E5%8A%A8%E7%86%94%E6%96%AD%20%E9%93%BE%E8%B7%AF%E8%B7%9F%E8%B8%AA%20%E8%87%AA%E5%8A%A8%E9%99%8D%E8%BD%BD%20...%3F%3F%3F%3F%3F%3F%3F%3F%3F%3F%3F%3F%3F%3F%20Redis%E9%9B%86%E7%BE%A4%20Redis%E9%9B%86%E7%BE%A4%20Redis%E9%9B%86%E7%BE%A4%20%E7%BC%93%E5%AD%98%E5%B1%82%20%E6%95%B0%E6%8D%AE%E5%BA%93%20MySQL%E9%9B%86%E7%BE%A4%20MongoDB%E9%9B%86%E7%BE%A4%20ClicKHouse%E9%9B%86%E7%BE%A4%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%2C%22width%22%3A2230%2C%22height%22%3A1422%7D"></card></p><h2 id="e5b3a67d" data-lake-id="f8a4d957d62344f20bf26ae2314566e7_h2_1">1. go-zero框架背景</h2><p data-lake-id="e10b48325c0d4a962327a38bc957bb07_p_15">18年初，晓黑板后端在经过频繁的宕机后，决定从<code>Java+MongoDB</code>的单体架构迁移到微服务架构，经过仔细思考和对比，我们决定：</p><p data-lake-id="42752743bc6d3f9f6c928fb47989b8c2_p_16"><br /></p><ul data-lake-id="00759c3b593e7f9b6f5699ceb7ff8810_ul_6"><li data-lake-id="4c2e17e14aff0a22effdc389f32dc0ff_li_6">基于Go语言</li></ul><ul data-lake-indent="1" data-lake-id="082f07e32ec6841b33151d30c4e3ec31_ul_7"><li data-lake-id="f6f61ccfb43f5de1185b365897816a00_li_7">高效的性能</li></ul><ul data-lake-indent="1" data-lake-id="b927fbe52d605d41bf1ea3d9763aed57_ul_8"><li data-lake-id="3a319baf0b30d31d9e294fb7ca56f719_li_8">简洁的语法</li></ul><ul data-lake-indent="1" data-lake-id="211655df0533f66ee7400cdd01a4e068_ul_9"><li data-lake-id="5baaae9064e5b630868f7237878f4118_li_9">广泛验证的工程效率</li></ul><ul data-lake-indent="1" data-lake-id="313ea902d5e4281c5491dc8678270c78_ul_10"><li data-lake-id="10c15234512aa4af20f178ce17f58b2b_li_10">极致的部署体验</li></ul><ul data-lake-indent="1" data-lake-id="e9569ed80d032d8173c4ca2ac6a901bd_ul_11"><li data-lake-id="e60c84e1d390596b60978dfd70122f28_li_11">极低的服务端资源成本</li></ul><ul data-lake-id="094eaef13fd0b5aa6ed7faadc71270d7_ul_12"><li data-lake-id="2dfeb550167843486bc49018a443e279_li_12">自研微服务框架</li></ul><ul data-lake-indent="1" data-lake-id="a96bd4a572e9c1307c3b8303d4a2966a_ul_13"><li data-lake-id="07730e083a3520c145313b0d8d230150_li_13">有过很多微服务框架自研经验</li></ul><ul data-lake-indent="1" data-lake-id="be574cb19ca900b2f7bd3829697ab2ee_ul_14"><li data-lake-id="568f9fc1facfcfb43c5917b3529e55d4_li_14">需要有更快速的问题定位能力</li></ul><ul data-lake-indent="1" data-lake-id="af59be516b3bad5d51be0c1b7ff83752_ul_15"><li data-lake-id="8bdf7c06b1969c190e600c9e66767281_li_15">更便捷的增加新特性</li></ul><p data-lake-id="c5eaf555cee01ec836fc749258c6179d_p_17"><br /></p><h2 id="9e43a8e0" data-lake-id="9ca8b86b0a14a9495974ce11cf2b68d9_h2_2">2. go-zero框架设计思考</h2><p data-lake-id="7b398b01273b19c0b4332518d17bd207_p_19">对于微服务框架的设计，我们期望保障微服务稳定性的同时，也要特别注重研发效率。所以设计之初，我们就有如下一些准则：</p><p data-lake-id="db841a6e995b001085603629a3ace379_p_20"><br /></p><ul data-lake-id="034f1adc8dd87b722fbb530306eb4f6d_ul_16"><li data-lake-id="ec213d60f4fd238c59b085a6619e262c_li_16">保持简单</li></ul><ul data-lake-id="de1b568e58da354b989c59cd4c2b584f_ul_17"><li data-lake-id="bc05d7047e80b314c7bb6df2b186d95e_li_17">高可用</li></ul><ul data-lake-id="f2f9e22c3fd6a29e190a0d295444f11c_ul_18"><li data-lake-id="6e3cadb74bbbe4d8631fab38efc7ab0d_li_18">高并发</li></ul><ul data-lake-id="ee66cb0f6d4a8302952411c322f2c887_ul_19"><li data-lake-id="100408ccbd734d0d6948c3465f101711_li_19">易扩展</li></ul><ul data-lake-id="cb808323f66f33ac1ad3e6abd330fdf2_ul_20"><li data-lake-id="e588337c2e124b5e72925d34aebaea38_li_20">弹性设计，面向故障编程</li></ul><ul data-lake-id="334ad236f3bba68de88d732d40794a7a_ul_21"><li data-lake-id="17ae663b8157ae6c3e81dd1cfe9e639c_li_21">尽可能对业务开发友好，封装复杂度</li></ul><ul data-lake-id="bdcda7f24654e08f1c3b088b079f0767_ul_22"><li data-lake-id="57b34bd6c58478d3c3cd57922fb07d1f_li_22">尽可能约束做一件事只有一种方式</li></ul><p data-lake-id="54d418504a63791b75a5f497078fa24a_p_21"><br /></p><p data-lake-id="91829620a3ac7a2dc5e6428baeadfd34_p_22">我们经历不到半年时间，彻底完成了从<code>Java+MongoDB</code>到<code>Golang+MySQL</code>为主的微服务体系迁移，并于18年8月底完全上线，稳定保障了晓黑板后续增长，确保了整个服务的高可用。</p><p data-lake-id="4547a4b65fb57fca5301c6973643450c_p_23"><br /></p><h2 id="faed0325" data-lake-id="decb1b451a7249768faf06d2d5a15d53_h2_3">3. go-zero项目实现和特点</h2><p data-lake-id="aea1044ee300ba7c55f5624177ae7e67_p_25">go-zero是一个集成了各种工程实践的包含web和rpc框架，有如下主要特点：</p><p data-lake-id="b57de0a6a045efefe71d109094be9ddc_p_26"><br /></p><ul data-lake-id="7b1c93c5937d03c4a433bec3a5588b47_ul_23"><li data-lake-id="4ef0bafd5bb04b32a8d44229d7be930b_li_23">强大的工具支持，尽可能少的代码编写</li></ul><ul data-lake-id="b0141c350b22c09e766834daecd2a6d6_ul_24"><li data-lake-id="ffdea8be96976e6c3613d03709d359db_li_24">极简的接口</li></ul><ul data-lake-id="ad4c1876f30974c6cb084b673d6e4bd2_ul_25"><li data-lake-id="302752b83c2ca65ed49464ef4577315c_li_25">完全兼容net/http</li></ul><ul data-lake-id="aab3c91beaa3ac8ade45a6dafdf4a14f_ul_26"><li data-lake-id="e2fba6b245f731f27996c1424e97786d_li_26">支持中间件，方便扩展</li></ul><ul data-lake-id="05aaea024f6fc5583b1400133b460af1_ul_27"><li data-lake-id="510505223e1e28ebccf3c8f601f13e49_li_27">高性能</li></ul><ul data-lake-id="c621fab98f14f9bd1de6d44d75e372e8_ul_28"><li data-lake-id="ee39d360b85ce8411726096d67d8b28a_li_28">面向故障编程，弹性设计</li></ul><ul data-lake-id="b7bf6a6b8b8abb3ba4930950fa605289_ul_29"><li data-lake-id="bb4c95e2074684332b009de7535d2b53_li_29">内建服务发现、负载均衡</li></ul><ul data-lake-id="33f1e0241062dff1b998d91a101f22bd_ul_30"><li data-lake-id="8483d929c34966c942373ed2c8b410c7_li_30">内建限流、熔断、降载，且自动触发，自动恢复</li></ul><ul data-lake-id="416fab2fc9ea71ff73bf565cd21ca737_ul_31"><li data-lake-id="d9c454f1b9be3a054582f59b3ca0c212_li_31">API参数自动校验</li></ul><ul data-lake-id="da779c6c741b6fe1bdc3189b85f2502a_ul_32"><li data-lake-id="37a28f3657527754392521004d887002_li_32">超时级联控制</li></ul><ul data-lake-id="966ea04d3f8b0f33862c1ffc9713f372_ul_33"><li data-lake-id="55a8a3e941ee3c968b7e1bd69724a229_li_33">自动缓存控制</li></ul><ul data-lake-id="15949b3700eca421e7abd079a94ab78e_ul_34"><li data-lake-id="3fa78d589d98df92b6f6b6c06584cb4b_li_34">链路跟踪、统计报警等</li></ul><ul data-lake-id="376cc48e6e4507b20f6dd80be2e8f71b_ul_35"><li data-lake-id="9925a2d01757c82395f90551c252cee6_li_35">高并发支撑，稳定保障了晓黑板疫情期间每天的流量洪峰</li></ul><p data-lake-id="f0ffc5bb1789c75bfc987f160b6dc7b0"><br /></p><p data-lake-id="c78705f395b2694f338767bff307ab98">如下图，我们从多个层面保障了整体服务的高可用：</p><p data-lake-id="e487da93574c9f6782aee8c3efa43f31"><card type="inline" name="image" value="data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2020%2Fjpeg%2F2623842%2F1601207450697-941ebb46-e89a-46d8-9378-55c446f8b8f2.jpeg%22%2C%22originWidth%22%3A2218%2C%22originHeight%22%3A902%2C%22name%22%3A%22resilience.jpg%22%2C%22size%22%3A153038%2C%22display%22%3A%22inline%22%2C%22align%22%3A%22left%22%2C%22linkTarget%22%3A%22_blank%22%2C%22status%22%3A%22done%22%2C%22ocrLocations%22%3A%5B%7B%22x%22%3A1274.5197%2C%22y%22%3A285.55698%2C%22width%22%3A254.07420000000002%2C%22height%22%3A52.09796%2C%22text%22%3A%22%E8%87%AA%E9%80%82%E5%BA%94%E7%86%94%E6%96%AD%22%7D%2C%7B%22x%22%3A847.9771%2C%22y%22%3A286.0793%2C%22width%22%3A256.66780000000006%2C%22height%22%3A50.86252999999999%2C%22text%22%3A%22%E8%87%AA%E9%80%82%E5%BA%94%E9%99%8D%E8%BD%BD%22%7D%2C%7B%22x%22%3A468.35004%2C%22y%22%3A286.76727%2C%22width%22%3A199.95886000000002%2C%22height%22%3A49.67975000000001%2C%22text%22%3A%22%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6%22%7D%2C%7B%22x%22%3A1696.1232%2C%22y%22%3A375.76068%2C%22width%22%3A193.88879999999995%2C%22height%22%3A56.77176000000003%2C%22text%22%3A%22RpcCall%22%7D%2C%7B%22x%22%3A48.326004%2C%22y%22%3A392.98978%2C%22width%22%3A224.01081599999998%2C%22height%22%3A49.34645999999998%2C%22text%22%3A%22Requests%22%7D%2C%7B%22x%22%3A823.58435%2C%22y%22%3A483.86856%2C%22width%22%3A313.82724999999994%2C%22height%22%3A56.792209999999955%2C%22text%22%3A%22K8S%E5%BC%B9%E6%80%A7%E4%BC%B8%E7%BC%A9%22%7D%2C%7B%22x%22%3A1274.1018%2C%22y%22%3A487.78564%2C%22width%22%3A204.34130000000005%2C%22height%22%3A50.826730000000055%2C%22text%22%3A%22%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%22%7D%2C%7B%22x%22%3A518.6278%2C%22y%22%3A492.11877%2C%22width%22%3A100.30164000000002%2C%22height%22%3A46.25173000000001%2C%22text%22%3A%22%E9%99%90%E6%B5%81%22%7D%5D%2C%22style%22%3A%22none%22%2C%22search%22%3A%22%E8%87%AA%E9%80%82%E5%BA%94%E7%86%94%E6%96%AD%20%E8%87%AA%E9%80%82%E5%BA%94%E9%99%8D%E8%BD%BD%20%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6%20RpcCall%20Requests%20K8S%E5%BC%B9%E6%80%A7%E4%BC%B8%E7%BC%A9%20%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%20%E9%99%90%E6%B5%81%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%2C%22width%22%3A2218%2C%22height%22%3A902%7D"></card></p><h2 id="dba1808d" data-lake-id="daf0673624ec5e5018753170f32135c2_h2_5">4. Installation</h2><p data-lake-id="1854750b60b1b65f49b61f16c68b325d_p_35">在项目目录下通过如下命令安装：</p><p data-lake-id="6f8f966688575a1f666bafa122494f73_p_36"><br /></p><card type="block" name="codeblock" value="data:%7B%22id%22%3A%22847f0e94%22%2C%22mode%22%3A%22shell%22%2C%22code%22%3A%22GOPROXY%3Dhttps%3A%2F%2Fgoproxy.cn%2F%2Cdirect%20go%20get%20-u%20github.com%2Ftal-tech%2Fgo-zero%22%7D"></card><p data-lake-id="ab57135091a86c42cc63ec67ac068a45_p_37"><br /></p><h2 id="8b04619e" data-lake-id="918909fa8f75a1105e214fb3aee3656e_h2_6">5. Quick Start</h2><ol start="1" data-lake-id="8e085cfa89691c577870b6332059f8bd_ol_0"><li data-lake-id="527925e28507828dff70a0e326a4eaac_li_38">安装goctl工具<br /><code>goctl</code>读作<code>go control</code>，不要读成<code>go C-T-L</code>。<code>goctl</code>的意思是不要被代码控制，而是要去控制它。其中的<code>go</code>不是指<code>golang</code>。在设计<code>goctl</code>之初，我就希望通过<code>她</code>来解放我们的双手👈<card type="block" name="codeblock" value="data:%7B%22id%22%3A%22c7be30eb%22%2C%22mode%22%3A%22shell%22%2C%22code%22%3A%22GO111MODULE%3Don%20GOPROXY%3Dhttps%3A%2F%2Fgoproxy.cn%2F%2Cdirect%20go%20get%20-u%20github.com%2Ftal-tech%2Fgo-zero%2Ftools%2Fgoctl%22%7D"></card><br />确保goctl可执行</li><li data-lake-id="f590d7c17221390849930e54f287bf11_li_40">快速生成api服务<card type="block" name="codeblock" value="data:%7B%22id%22%3A%220c90de8e%22%2C%22mode%22%3A%22shell%22%2C%22code%22%3A%22%20%20%20goctl%20api%20new%20greet%5Cn%20%20%20cd%20greet%5Cn%20%20%20go%20run%20greet.go%20-f%20etc%2Fgreet-api.yaml%22%7D"></card><br />默认侦听在8888端口（可以在配置文件里修改），可以通过curl请求：<card type="block" name="codeblock" value="data:%7B%22id%22%3A%22d7af2f27%22%2C%22mode%22%3A%22shell%22%2C%22code%22%3A%22%20%20%20curl%20-i%20http%3A%2F%2Flocalhost%3A8888%2Ffrom%2Fyou%22%7D"></card><br />返回如下：<card type="block" name="codeblock" value="data:%7B%22id%22%3A%22cfe984c1%22%2C%22mode%22%3A%22http%22%2C%22code%22%3A%22%20%20%20HTTP%2F1.1%20200%20OK%5Cn%20%20%20Date%3A%20Sun%2C%2030%20Aug%202020%2015%3A32%3A35%20GMT%5Cn%20%20%20Content-Length%3A%200%22%7D"></card><br />编写业务代码：</li></ol><ul data-lake-indent="1" data-lake-id="cd1b5c81821adcedadfbbfa4580af676_ul_38"><li data-lake-id="94c009cb25456703cc05eafc0c2c821c_li_41">api文件定义了服务对外暴露的路由，可参考<a href="https://github.com/tal-tech/zero-doc/blob/main/doc/goctl.md" target="_blank">api规范</a></li></ul><ul data-lake-indent="1" data-lake-id="5fa3cd91797281f8fb0d66795b565736_ul_39"><li data-lake-id="e22ef173dc00e586419f7497891c1c50_li_42">可以在servicecontext.go里面传递依赖给logic，比如mysql, redis等</li></ul><ul data-lake-indent="1" data-lake-id="bdd7e880e159a9982e17285f84181061_ul_40"><li data-lake-id="59d468a12f69446f06aa68351cc67401_li_43">在api定义的get/post/put/delete等请求对应的logic里增加业务处理逻辑</li></ul><ol start="3" data-lake-id="b5fa39746c0b8d4c0b28a59558004297_ol_3"><li data-lake-id="5490d4454b240b233d4227e04a3f4f06_li_44">可以根据api文件生成前端需要的Java, TypeScript, Dart, JavaScript代码<card type="block" name="codeblock" value="data:%7B%22id%22%3A%22df5d8408%22%2C%22mode%22%3A%22shell%22%2C%22code%22%3A%22goctl%20api%20java%20-api%20greet.api%20-dir%20greet%5Cngoctl%20api%20dart%20-api%20greet.api%20-dir%20greet%5Cn...%22%7D"></card></li></ol><p data-lake-id="e958cf3cbcb7eddc04fd08f48957ec20"><br /></p><h2 data-lake-id="9725555f98fa228ad6ad32d67c21dcd7" id="djCDr">6. go-zero背后的设计思考</h2><p data-lake-id="ffe139ac25732c86bd3f436b9bcbbf74" style="text-indent: 2em;">go-zero背后的思考，从整体上来理解微服务系统设计：</p><p data-lake-id="8b0d1da416d1cbda2715429e96b1b96a" style="text-indent: 2em;"><a href="https://www.bilibili.com/video/BV1rD4y127PD/" target="_blank">https://www.bilibili.com/video/BV1rD4y127PD/</a></p>',
        BZvQ3u: '<!doctype lake><meta name="doc-version" content="1" /><meta name="viewport" content="fixed" /><meta name="typography" content="traditional" /><h2 id="6bc775e9" data-lake-id="2a587d29c4d8fa2b5804f319c35aae39">0. 为什么说做好微服务很难</h2><p data-lake-id="52bf227728e95f6d80adea0e3fb97d7e"><br /></p><p data-lake-id="bf34e6e42a0350a5f79e176c4542b35e">要想做好微服务，我们需要理解和掌握的知识点非常多，从几个维度上来说：</p><p data-lake-id="e51cb7e42dcf4523bed95d5a05ede77b"><br /></p><ul data-lake-id="6137e14f9f033d0a774cc9ead2834663"><li data-lake-id="69140a88f6dfa29096f61e88c9e16478">基本功能层面</li></ul><ol data-lake-indent="1" data-lake-id="385b3acd2864d636b38835cb34d6b0ea"><li data-lake-id="3cf2427dbde259df029b8e85f8f86a71">并发控制&amp;限流，避免服务被突发流量击垮</li><li data-lake-id="b83907b571eacecef6db67bf93692e74">服务注册与服务发现，确保能够动态侦测增减的节点</li><li data-lake-id="d1c60cf5d889b05cfb78a275d5c43dde">负载均衡，需要根据节点承受能力分发流量</li><li data-lake-id="7dc9e181dff5f9a465af22827091041f">超时控制，避免对已超时请求做无用功</li><li data-lake-id="0fc61eb418928285a8afee34d8a7e8db">熔断设计，快速失败，保障故障节点的恢复能力</li></ol><ul data-lake-id="bc058662b1098f318920d73dd10b876b"><li data-lake-id="5b1a67820a6735676715d77e4f00e31d">高阶功能层面</li></ul><ol data-lake-indent="1" data-lake-id="be18404b43e7424edc8b9bf56c46009c"><li data-lake-id="45913dd830bd19cb53c3c3d796f71f5b">请求认证，确保每个用户只能访问自己的数据</li><li data-lake-id="c993c9967a76f3278e022fc097e47886">链路追踪，用于理解整个系统和快速定位特定请求的问题</li><li data-lake-id="f5db9e3e889fa14fe1525618f6ad98fa">日志，用于数据收集和问题定位</li><li data-lake-id="04a1ec4b8861038557419588dd81e994">可观测性，没有度量就没有优化</li></ol><p data-lake-id="040b13ecf50aff341d67620fcd06ddf6"><br /></p><p data-lake-id="81c6186c662569cf3668c4c6bc0fe7c4">对于其中每一点，我们都需要用很长的篇幅来讲述其原理和实现，那么对我们后端开发者来说，要想把这些知识点都掌握并落实到业务系统里，难度是非常大的，不过我们可以依赖已经被大流量验证过的框架体系。<a href="https://github.com/tal-tech/go-zero" target="_blank">go-zero微服务框架</a>就是为此而生。</p><p data-lake-id="ecec5b6166b96c4871fc6c698e9daec6"><br /></p><p data-lake-id="10d9045bfbac76da4abee20d0c79bc12">另外，我们始终秉承<strong>工具大于约定和文档</strong>的理念。我们希望尽可能减少开发人员的心智负担，把精力都投入到产生业务价值的代码上，减少重复代码的编写，所以我们开发了<code>goctl</code>工具。</p><p data-lake-id="c9c67a95f02ffc96de9d435bf731ee9d"><br /></p><p data-lake-id="575474fdd056baa9f84490700f10e265">下面我通过书店服务来演示通过<a href="https://github.com/tal-tech/go-zero" target="_blank">go-zero</a>快速的创建微服务的流程，走完一遍，你就会发现：原来编写微服务如此简单！</p><p data-lake-id="8e4273b074ea460b4b32f6c7cb309b94"><br /></p><h2 id="878bad34" data-lake-id="b9027f3756d6d63da9bfdead3bd30d7a">1. 书店服务示例简介</h2><p data-lake-id="a1c13df56debcbd410eb65a45c9555ee"><br /></p><p data-lake-id="4adc604ac05aa4287d5db0898f260b53">为了教程简单，我们用书店服务做示例，并且只实现其中的增加书目和检查价格功能。</p><p data-lake-id="a37b96ec372966530d50a5b737dd8f17"><br /></p><p data-lake-id="2dbdd7eb57e2dcd5ed8310d52b73f9c0">写此书店服务是为了从整体上演示go-zero构建完整微服务的过程，实现细节尽可能简化了。</p><p data-lake-id="42fa7661670c0ec840a25e83de8f877c"><br /></p><h2 id="bcea83be" data-lake-id="86e3ea9b8ff2b6d4482186747ac756a0">2. 书店微服务架构图</h2><p data-lake-id="69b34607a5b282a3ae7af3253e7df60d"><br /></p><p data-lake-id="ef7a0328edcc67e8b5900df4dfeacf50"><card type="inline" name="image" value="data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2020%2Fpng%2F261626%2F1608448609449-13ac016e-1400-4636-a67e-6a25bd58dbfb.png%22%2C%22originWidth%22%3A2320%2C%22originHeight%22%3A1100%2C%22size%22%3A0%2C%22display%22%3A%22inline%22%2C%22align%22%3A%22left%22%2C%22linkTarget%22%3A%22_blank%22%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22search%22%3A%22%22%2C%22margin%22%3A%7B%22top%22%3Afalse%2C%22bottom%22%3Afalse%7D%2C%22width%22%3A800%2C%22height%22%3A379%7D"></card></p><p data-lake-id="c51307a8e3f9d8dbdee2740b34508a46"><br /></p><h2 id="00d828d7" data-lake-id="6663ee4ce378338c34b61ecc7ff1f26b">3. goctl各层代码生成一览</h2><p data-lake-id="20191e3db765b2de616d78437a6ad192"><br /></p><p data-lake-id="c9d2212900cbaf8d0c89b3485da98c0b">所有绿色背景的功能模块是自动生成的，按需激活，红色模块是需要自己写的，也就是增加下依赖，编写业务特有逻辑，各层示意图分别如下：</p><p data-lake-id="b44d0cc69d76f5fbe93a71ee840f91e4"><br /></p><ul data-lake-id="c55e5699583decab0b84caa92720abbe"><li data-lake-id="239e0110a83e647b59ea678cfe65f9f8">API Gateway<card type="inline" name="image" value="data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2020%2Fpng%2F261626%2F1608448609449-1f4a259a-32ae-42ec-97e0-7677aa3c6482.png%22%2C%22originWidth%22%3A1814%2C%22originHeight%22%3A494%2C%22size%22%3A0%2C%22display%22%3A%22inline%22%2C%22align%22%3A%22left%22%2C%22linkTarget%22%3A%22_blank%22%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22search%22%3A%22%22%2C%22margin%22%3A%7B%22top%22%3Afalse%2C%22bottom%22%3Afalse%7D%2C%22width%22%3A800%2C%22height%22%3A494%7D"></card></li><li data-lake-id="38156e276bf7a06d11e7616df8e39815">RPC<card type="inline" name="image" value="data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2020%2Fpng%2F261626%2F1608448609436-9f9bf2b9-e25e-4679-9991-5d3586dc158f.png%22%2C%22originWidth%22%3A1594%2C%22originHeight%22%3A456%2C%22size%22%3A0%2C%22display%22%3A%22inline%22%2C%22align%22%3A%22left%22%2C%22linkTarget%22%3A%22_blank%22%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22search%22%3A%22%22%2C%22margin%22%3A%7B%22top%22%3Afalse%2C%22bottom%22%3Afalse%7D%2C%22width%22%3A800%2C%22height%22%3A456%7D"></card></li><li data-lake-id="5aaec27e5ed8ffbbff054f67cbf79e84">model<card type="inline" name="image" value="data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2020%2Fpng%2F261626%2F1608448609472-063fcf30-575b-4d3f-b9bf-080fac50d898.png%22%2C%22originWidth%22%3A1592%2C%22originHeight%22%3A426%2C%22size%22%3A0%2C%22display%22%3A%22inline%22%2C%22align%22%3A%22left%22%2C%22linkTarget%22%3A%22_blank%22%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22search%22%3A%22%22%2C%22margin%22%3A%7B%22top%22%3Afalse%2C%22bottom%22%3Afalse%7D%2C%22width%22%3A800%2C%22height%22%3A426%7D"></card></li></ul><p data-lake-id="db28c8b216084459eac8221d53d963aa"><br /></p><p data-lake-id="4ef05004bbf1450ec8913fe4f81566e5">下面我们来一起完整走一遍快速构建微服务的流程，Let’s <code>Go</code>!🏃‍♂️</p><p data-lake-id="9a649513dbdd9253f5b68bf873b20262"><br /></p><h2 id="9d06e4f5" data-lake-id="4e5d0a061a1d7deb3a897fad89bb7cec">4. 准备工作</h2><p data-lake-id="508899777ee2eba6ffa86693e6c8d555"><br /></p><ul data-lake-id="2107afb090ec3b1c24d4f2b5cdc4ab75"><li data-lake-id="4ecf6f5f6029e479fa1d1f6e2527534a">安装etcd, mysql, redis</li><li data-lake-id="e0f53a88aa5b9c21789fee7b4f8d0f2c">安装<code>protoc-gen-go</code></li></ul><card type="block" name="codeblock" value="data:%7B%22id%22%3A%22b7753f35%22%2C%22mode%22%3A%22shell%22%2C%22code%22%3A%22go%20get%20-u%20github.com%2Fgolang%2Fprotobuf%2Fprotoc-gen-go%22%7D"></card><ul data-lake-id="37f0a2ab3c918dba262105ef5919e5aa"><li data-lake-id="a372eb31e7e50aa45bfde2f036d2485c">安装goctl工具</li></ul><card type="block" name="codeblock" value="data:%7B%22id%22%3A%22c7be30eb%22%2C%22mode%22%3A%22shell%22%2C%22code%22%3A%22GO111MODULE%3Don%20GOPROXY%3Dhttps%3A%2F%2Fgoproxy.cn%2F%2Cdirect%20go%20get%20-u%20github.com%2Ftal-tech%2Fgo-zero%2Ftools%2Fgoctl%22%7D"></card><ul data-lake-id="fec68265b03695e641180f334c7ae189"><li data-lake-id="9eb533238dd802c8f569a78b7c455be4">创建工作目录 <code>bookstore</code> 和 <code>bookstore/api</code></li><li data-lake-id="bb0efffcf6c897454b057b4c7178768d">在<code>bookstore</code>目录下执行<code>go mod init bookstore</code>初始化<code>go.mod</code></li></ul><p data-lake-id="5fc5b1c6d595c856247f983137ac1ed2"><br /></p><h2 id="9a5a0085" data-lake-id="6360738a61978dcc4fd09e1e6fb4c86d">5. 编写API Gateway代码</h2><p data-lake-id="2d6e9a215a2c1456880c2b2e54fe597a"><br /></p><ul data-lake-id="10112a67df242e01539aea1e910ea6fb"><li data-lake-id="95d4a9473c6cff3b54e9b058d848116c">在<code>bookstore/api</code>目录下通过goctl生成<code>api/bookstore.api</code>：</li></ul><card type="block" name="codeblock" value="data:%7B%22id%22%3A%22a15baf8a%22%2C%22mode%22%3A%22bash%22%2C%22code%22%3A%22goctl%20api%20-o%20bookstore.api%22%7D"></card><ul data-lake-id="d5eec053999d926f39e9fa1b14267cc9"><li data-lake-id="963464aee44ec3a6580ef0435c95e812">编辑<code>bookstore.api</code>，为了简洁，去除了文件开头的<code>info</code>，代码如下：</li></ul><card type="block" name="codeblock" value="data:%7B%22id%22%3A%227130c0aa%22%2C%22mode%22%3A%22go%22%2C%22code%22%3A%22type%20(%5Cn%5CtaddReq%20%7B%5Cn%5Ct%5Ctbook%20string%20%60form%3A%5C%22book%5C%22%60%5Cn%5Ct%5Ctprice%20int64%20%60form%3A%5C%22price%5C%22%60%5Cn%5Ct%7D%5Cn%5Ct%5Cn%5CtaddResp%20%7B%5Cn%5Ct%5Ctok%20bool%20%60json%3A%5C%22ok%5C%22%60%5Cn%5Ct%7D%5Cn)%5Cn%5Cntype%20(%5Cn%5CtcheckReq%20%7B%5Cn%5Ct%5Ctbook%20string%20%60form%3A%5C%22book%5C%22%60%5Cn%5Ct%7D%5Cn%5Ct%5Cn%5CtcheckResp%20%7B%5Cn%5Ct%5Ctfound%20bool%20%60json%3A%5C%22found%5C%22%60%5Cn%5Ct%5Ctprice%20int64%20%60json%3A%5C%22price%5C%22%60%5Cn%5Ct%7D%5Cn)%5Cn%5Cnservice%20bookstore-api%20%7B%5Cn%5Ct%40handler%20AddHandler%5Cn%5Ctget%20%2Fadd%20(addReq)%20returns%20(addResp)%5Cn%5Ct%5Cn%5Ct%40handler%20CheckHandler%5Cn%5Ctget%20%2Fcheck%20(checkReq)%20returns%20(checkResp)%5Cn%7D%22%7D"></card><ul data-lake-id="d5d91a6229fdf09e349b5679dfb8ace8"><li data-lake-id="27f14766e5ad3793ffcb6734872ddf69">type用法和go一致，service用来定义get/post/head/delete等api请求，解释如下：</li></ul><ul data-lake-indent="1" data-lake-id="c6ddf4e1810fcbef99d4a184865a7c58"><li data-lake-id="2d2c734927630ee5267bdb65870ea796"><code>service bookstore-api {</code>这一行定义了service名字</li><li data-lake-id="e2e3ff24d951551d4a057af503c69b49"><code>@handler</code>定义了服务端handler名字</li><li data-lake-id="bc17f76fd5905ed3290381d3164f7274"><code>get /add(addReq) returns(addResp)</code>定义了get方法的路由、请求参数、返回参数等</li></ul><ul data-lake-id="720b873e9cb1dc1ca61b9da2d57e0f93"><li data-lake-id="59fd09152d8bd5b44322315d78172626">使用goctl生成API Gateway代码</li></ul><card type="block" name="codeblock" value="data:%7B%22id%22%3A%22ac67fcb4%22%2C%22mode%22%3A%22shell%22%2C%22code%22%3A%22goctl%20api%20go%20-api%20bookstore.api%20-dir%20.%22%7D"></card><ul data-lake-id="c8e64fb8e979d98b517a6ab12bc0dbec"><li data-lake-id="8f1347d6899ec96d98dc0c322b2c18f3">生成的文件结构如下：</li></ul><card type="block" name="codeblock" value="data:%7B%22id%22%3A%22a5b7769f%22%2C%22mode%22%3A%22plain%22%2C%22code%22%3A%22api%5Cn%E2%94%9C%E2%94%80%E2%94%80%20bookstore.api%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20api%E5%AE%9A%E4%B9%89%5Cn%E2%94%9C%E2%94%80%E2%94%80%20bookstore.go%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20main%E5%85%A5%E5%8F%A3%E5%AE%9A%E4%B9%89%5Cn%E2%94%9C%E2%94%80%E2%94%80%20etc%5Cn%E2%94%82%20%20%20%E2%94%94%E2%94%80%E2%94%80%20bookstore-api.yaml%20%20%20%20%20%20%20%20%20%2F%2F%20%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%5Cn%E2%94%94%E2%94%80%E2%94%80%20internal%5Cn%20%20%20%20%E2%94%9C%E2%94%80%E2%94%80%20config%5Cn%20%20%20%20%E2%94%82%20%20%20%E2%94%94%E2%94%80%E2%94%80%20config.go%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E5%AE%9A%E4%B9%89%E9%85%8D%E7%BD%AE%5Cn%20%20%20%20%E2%94%9C%E2%94%80%E2%94%80%20handler%5Cn%20%20%20%20%E2%94%82%20%20%20%E2%94%9C%E2%94%80%E2%94%80%20addhandler.go%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E5%AE%9E%E7%8E%B0addHandler%5Cn%20%20%20%20%E2%94%82%20%20%20%E2%94%9C%E2%94%80%E2%94%80%20checkhandler.go%20%20%20%20%20%20%20%20%2F%2F%20%E5%AE%9E%E7%8E%B0checkHandler%5Cn%20%20%20%20%E2%94%82%20%20%20%E2%94%94%E2%94%80%E2%94%80%20routes.go%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E5%AE%9A%E4%B9%89%E8%B7%AF%E7%94%B1%E5%A4%84%E7%90%86%5Cn%20%20%20%20%E2%94%9C%E2%94%80%E2%94%80%20logic%5Cn%20%20%20%20%E2%94%82%20%20%20%E2%94%9C%E2%94%80%E2%94%80%20addlogic.go%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E5%AE%9E%E7%8E%B0AddLogic%5Cn%20%20%20%20%E2%94%82%20%20%20%E2%94%94%E2%94%80%E2%94%80%20checklogic.go%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E5%AE%9E%E7%8E%B0CheckLogic%5Cn%20%20%20%20%E2%94%9C%E2%94%80%E2%94%80%20svc%5Cn%20%20%20%20%E2%94%82%20%20%20%E2%94%94%E2%94%80%E2%94%80%20servicecontext.go%20%20%20%20%20%20%2F%2F%20%E5%AE%9A%E4%B9%89ServiceContext%5Cn%20%20%20%20%E2%94%94%E2%94%80%E2%94%80%20types%5Cn%20%20%20%20%20%20%20%20%E2%94%94%E2%94%80%E2%94%80%20types.go%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E5%AE%9A%E4%B9%89%E8%AF%B7%E6%B1%82%E3%80%81%E8%BF%94%E5%9B%9E%E7%BB%93%E6%9E%84%E4%BD%93%22%7D"></card><ul data-lake-id="3608b2842dabd490ee4fdf59d8506410"><li data-lake-id="01a39731e4369456f2285a7f12458e56">在 <code>api</code> 目录下启动API Gateway服务，默认侦听在8888端口</li></ul><card type="block" name="codeblock" value="data:%7B%22id%22%3A%22cfd144a4%22%2C%22mode%22%3A%22shell%22%2C%22code%22%3A%22go%20run%20bookstore.go%20-f%20etc%2Fbookstore-api.yaml%22%7D"></card><ul data-lake-id="9f87da917cfcb9d9543e6eea4419ea73"><li data-lake-id="611d0ec2fed6f03f4966ee1dfbd9e4b1">测试API Gateway服务</li></ul><card type="block" name="codeblock" value="data:%7B%22id%22%3A%220d3bfb86%22%2C%22mode%22%3A%22shell%22%2C%22code%22%3A%22curl%20-i%20%5C%22http%3A%2F%2Flocalhost%3A8888%2Fcheck%3Fbook%3Dgo-zero%5C%22%22%7D"></card><ul data-lake-id="70205d64c0b49d489429e688be36c45b"><li data-lake-id="7b58a4c09f344136d978be692097289a">返回如下：</li></ul><card type="block" name="codeblock" value="data:%7B%22id%22%3A%22323f7d09%22%2C%22mode%22%3A%22http%22%2C%22code%22%3A%22HTTP%2F1.1%20200%20OK%5CnContent-Type%3A%20application%2Fjson%5CnDate%3A%20Thu%2C%2003%20Sep%202020%2006%3A46%3A18%20GMT%5CnContent-Length%3A%2025%5Cn%5Cn%7B%5C%22found%5C%22%3Afalse%2C%5C%22price%5C%22%3A0%7D%22%7D"></card><ul data-lake-id="79eb124604c65d7df1e3a94d437eec51"><li data-lake-id="11508fcc227fc300825023594e8bfc98">可以看到我们API Gateway其实啥也没干，就返回了个空值，接下来我们会在rpc服务里实现业务逻辑</li><li data-lake-id="102e10ebd8262c7db75502a217113de2">可以修改<code>internal/svc/servicecontext.go</code>来传递服务依赖（如果需要）</li><li data-lake-id="ebeaa1a0689bd74bcf1acf9c467014ee">实现逻辑可以修改<code>internal/logic</code>下的对应文件</li><li data-lake-id="a1fe8b48855c9bd94739bfbd9138111e">可以通过<code>goctl</code>生成各种客户端语言的api调用代码</li><li data-lake-id="dbcb3e3e7d07af18726f713f2fe90c2b">到这里，你已经可以通过goctl生成客户端代码给客户端同学并行开发了，支持多种语言，详见文档</li></ul><p data-lake-id="ee6ddcae9d524929bf88432e6a0b54cf"><br /></p><h2 id="bc1a0902" data-lake-id="02685d0cb3e1b2456452e73019931ef4">6. 编写add rpc服务</h2><p data-lake-id="d7273dc061d9f6e6b044c4cfe077405b"><br /></p><ul data-lake-id="16df54961259477015cdf3735d67a0ae"><li data-lake-id="a3fd5d292b4084b3ce57d385d76a62ff">在 <code>bookstore</code> 下创建 <code>rpc</code> 目录</li></ul><p data-lake-id="a17fbcbb7b28745a4fa41fc520039d6f"><br /></p><ul data-lake-id="224c6ee99e379c648247c9010cda8096"><li data-lake-id="09332a56324801f4066389f2b549bd41">在<code>rpc/add</code>目录下编写<code>add.proto</code>文件<br />可以通过命令生成proto文件模板</li></ul><card type="block" name="codeblock" value="data:%7B%22id%22%3A%226515f16a%22%2C%22mode%22%3A%22shell%22%2C%22code%22%3A%22goctl%20rpc%20template%20-o%20add.proto%22%7D"></card><ul data-lake-id="3fe39b21c8893afd26bd32ad6e3de7e9"><li data-lake-id="a8a42cc03870736d83269443274d09fa">修改后文件内容如下：</li></ul><card type="block" name="codeblock" value="data:%7B%22id%22%3A%2252c010ff%22%2C%22mode%22%3A%22protobuf%22%2C%22code%22%3A%22syntax%20%3D%20%5C%22proto3%5C%22%3B%5Cn%5Cnpackage%20add%3B%5Cn%5Cnmessage%20addReq%20%7B%5Cn%20%20%20%20string%20book%20%3D%201%3B%5Cn%20%20%20%20int64%20price%20%3D%202%3B%5Cn%7D%5Cn%5Cnmessage%20addResp%20%7B%5Cn%20%20%20%20bool%20ok%20%3D%201%3B%5Cn%7D%5Cn%5Cnservice%20adder%20%7B%5Cn%20%20%20%20rpc%20add(addReq)%20returns(addResp)%3B%5Cn%7D%22%7D"></card><ul data-lake-id="ca10ce68375e15a7af7e8aa4ed552e3b"><li data-lake-id="747ff043215fbb6effc2b3dbfb19efde">用<code>goctl</code>生成rpc代码，在<code>rpc/add</code>目录下执行命令</li></ul><card type="block" name="codeblock" value="data:%7B%22id%22%3A%2259a08887%22%2C%22mode%22%3A%22shell%22%2C%22code%22%3A%22goctl%20rpc%20proto%20-src%20add.proto%20-dir%20.%22%7D"></card><ul data-lake-id="5aeb6b5bbed7eb94437fb01dd0d8eef6"><li data-lake-id="524d7eb575a9984278ce066ca63a246d">文件结构如下：</li></ul><card type="block" name="codeblock" value="data:%7B%22id%22%3A%2241652bd1%22%2C%22mode%22%3A%22plain%22%2C%22code%22%3A%22rpc%2Fadd%5Cn%E2%94%9C%E2%94%80%E2%94%80%20add%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20pb.go%5Cn%E2%94%82%20%20%20%E2%94%94%E2%94%80%E2%94%80%20add.pb.go%5Cn%E2%94%9C%E2%94%80%E2%94%80%20add.go%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20main%E5%87%BD%E6%95%B0%E5%85%A5%E5%8F%A3%5Cn%E2%94%9C%E2%94%80%E2%94%80%20add.proto%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20proto%E6%BA%90%E6%96%87%E4%BB%B6%5Cn%E2%94%9C%E2%94%80%E2%94%80%20adder%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20rpc%20client%20call%20entry%5Cn%E2%94%82%20%20%20%E2%94%94%E2%94%80%E2%94%80%20adder.go%5Cn%E2%94%9C%E2%94%80%E2%94%80%20etc%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20yaml%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%5Cn%E2%94%82%20%20%20%E2%94%94%E2%94%80%E2%94%80%20add.yaml%5Cn%E2%94%94%E2%94%80%E2%94%80%20internal%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Cn%20%20%20%20%E2%94%9C%E2%94%80%E2%94%80%20config%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20yaml%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%AF%B9%E5%BA%94%E7%9A%84%E7%BB%93%E6%9E%84%E4%BD%93%E5%AE%9A%E4%B9%89%5Cn%20%20%20%20%E2%94%82%20%20%20%E2%94%94%E2%94%80%E2%94%80%20config.go%5Cn%20%20%20%20%E2%94%9C%E2%94%80%E2%94%80%20logic%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%5Cn%20%20%20%20%E2%94%82%20%20%20%E2%94%94%E2%94%80%E2%94%80%20addlogic.go%5Cn%20%20%20%20%E2%94%9C%E2%94%80%E2%94%80%20server%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20rpc%20server%5Cn%20%20%20%20%E2%94%82%20%20%20%E2%94%94%E2%94%80%E2%94%80%20adderserver.go%5Cn%20%20%20%20%E2%94%94%E2%94%80%E2%94%80%20svc%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E8%B5%84%E6%BA%90%E4%BE%9D%E8%B5%96%5Cn%20%20%20%20%20%20%20%20%E2%94%94%E2%94%80%E2%94%80%20servicecontext.go%22%7D"></card><p data-lake-id="af8e27572aa9bddb7d8626db1d1da14c"><br /></p><p data-lake-id="f56f1e4a4e8669348f46b051575b1488">直接可以运行，如下：</p><p data-lake-id="3091087d32eafb6b5a2e9961ebaa08b5"><br /></p><card type="block" name="codeblock" value="data:%7B%22id%22%3A%221515ff1a%22%2C%22mode%22%3A%22shell%22%2C%22code%22%3A%22%20%20%24%20go%20run%20add.go%20-f%20etc%2Fadd.yaml%5Cn%20%20Starting%20rpc%20server%20at%20127.0.0.1%3A8080...%22%7D"></card><p data-lake-id="57bda1d4bf4400bbcb3354461583be86"><br /></p><p data-lake-id="e80728665a42d9d92f590e2eae3b0baa"><code>etc/add.yaml</code>文件里可以修改侦听端口等配置</p><p data-lake-id="e9b826a8ec3a1030f1e7a5484d751b45"><br /></p><h2 id="1675f3c3" data-lake-id="ef0e7c41da8c4497abd753d550ce4ffa">7. 编写check rpc服务</h2><p data-lake-id="876e0aec69809c57824dd5c158391d6b"><br /></p><ul data-lake-id="fd762b20516121af6ddb5127a4d883b2"><li data-lake-id="fbb853e1742ff612d164fee22c092658">在<code>rpc/check</code>目录下编写<code>check.proto</code>文件<br />可以通过命令生成proto文件模板</li></ul><card type="block" name="codeblock" value="data:%7B%22id%22%3A%220545444b%22%2C%22mode%22%3A%22shell%22%2C%22code%22%3A%22goctl%20rpc%20template%20-o%20check.proto%22%7D"></card><ul data-lake-id="f4505ffe5071a458e58ae4eebb871996"><li data-lake-id="acb4ba9f55e96fcceb9d040d841ea86a">修改后文件内容如下：</li></ul><card type="block" name="codeblock" value="data:%7B%22id%22%3A%2265727678%22%2C%22mode%22%3A%22protobuf%22%2C%22code%22%3A%22syntax%20%3D%20%5C%22proto3%5C%22%3B%5Cn%5Cnpackage%20check%3B%5Cn%5Cnmessage%20checkReq%20%7B%5Cn%20%20%20%20string%20book%20%3D%201%3B%5Cn%7D%5Cn%5Cnmessage%20checkResp%20%7B%5Cn%20%20%20%20bool%20found%20%3D%201%3B%5Cn%20%20%20%20int64%20price%20%3D%202%3B%5Cn%7D%5Cn%5Cnservice%20checker%20%7B%5Cn%20%20%20%20rpc%20check(checkReq)%20returns(checkResp)%3B%5Cn%7D%22%7D"></card><ul data-lake-id="05daa1aba011c72ce3cdbc0053941674"><li data-lake-id="b857f57af0fd1532cf6d69a3830c2634">用<code>goctl</code>生成rpc代码，在<code>rpc/check</code>目录下执行命令</li></ul><card type="block" name="codeblock" value="data:%7B%22id%22%3A%226ae08eab%22%2C%22mode%22%3A%22shell%22%2C%22code%22%3A%22goctl%20rpc%20proto%20-src%20check.proto%20-dir%20.%22%7D"></card><ul data-lake-id="fb5edb24654890cafd0dc92fd83bad66"><li data-lake-id="1ea37289352ae417574d1eb2dcb1a2b4">文件结构如下：</li></ul><card type="block" name="codeblock" value="data:%7B%22id%22%3A%22b22700e2%22%2C%22mode%22%3A%22plain%22%2C%22code%22%3A%22rpc%2Fcheck%5Cn%E2%94%9C%E2%94%80%E2%94%80%20check%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20pb.go%5Cn%E2%94%82%20%20%20%E2%94%94%E2%94%80%E2%94%80%20check.pb.go%5Cn%E2%94%9C%E2%94%80%E2%94%80%20check.go%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20main%E5%85%A5%E5%8F%A3%5Cn%E2%94%9C%E2%94%80%E2%94%80%20check.proto%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20proto%E6%BA%90%E6%96%87%E4%BB%B6%5Cn%E2%94%9C%E2%94%80%E2%94%80%20checker%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20rpc%20client%20call%20entry%5Cn%E2%94%82%20%20%20%E2%94%94%E2%94%80%E2%94%80%20checker.go%5Cn%E2%94%9C%E2%94%80%E2%94%80%20etc%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20yaml%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%5Cn%E2%94%82%20%20%20%E2%94%94%E2%94%80%E2%94%80%20check.yaml%5Cn%E2%94%94%E2%94%80%E2%94%80%20internal%5Cn%20%20%20%20%E2%94%9C%E2%94%80%E2%94%80%20config%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20yaml%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%AF%B9%E5%BA%94%E7%9A%84%E7%BB%93%E6%9E%84%E4%BD%93%E5%AE%9A%E4%B9%89%5Cn%20%20%20%20%E2%94%82%20%20%20%E2%94%94%E2%94%80%E2%94%80%20config.go%5Cn%20%20%20%20%E2%94%9C%E2%94%80%E2%94%80%20logic%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%5Cn%20%20%20%20%E2%94%82%20%20%20%E2%94%94%E2%94%80%E2%94%80%20checklogic.go%5Cn%20%20%20%20%E2%94%9C%E2%94%80%E2%94%80%20server%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20rpc%20server%5Cn%20%20%20%20%E2%94%82%20%20%20%E2%94%94%E2%94%80%E2%94%80%20checkerserver.go%5Cn%20%20%20%20%E2%94%94%E2%94%80%E2%94%80%20svc%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E8%B5%84%E6%BA%90%E4%BE%9D%E8%B5%96%5Cn%20%20%20%20%20%20%20%20%E2%94%94%E2%94%80%E2%94%80%20servicecontext.go%22%7D"></card><ul data-lake-id="1df73f46476a342b05c01dde6189b299"><li data-lake-id="06272f33dff5fa31d798838935ba8072"><code>etc/check.yaml</code>文件里可以修改侦听端口等配置<br />需要修改<code>etc/check.yaml</code>的端口为<code>8081</code>，因为<code>8080</code>已经被<code>add</code>服务使用了，直接可以运行，如下：</li></ul><card type="block" name="codeblock" value="data:%7B%22id%22%3A%22bcfbb787%22%2C%22mode%22%3A%22shell%22%2C%22code%22%3A%22%24%20go%20run%20check.go%20-f%20etc%2Fcheck.yaml%5CnStarting%20rpc%20server%20at%20127.0.0.1%3A8081...%22%7D"></card><p data-lake-id="d1680969fb33df573f24da8635a0dd06"><br /></p><h2 id="c3cb8ebd" data-lake-id="017e7b74e43114c7e2890f66b2eb079a">8. 修改API Gateway代码调用add/check rpc服务</h2><p data-lake-id="94f031bd6e7f30fabf10d89c40515032"><br /></p><ul data-lake-id="239dd1aa1dede8576ad3ebf400bc781d"><li data-lake-id="18a496be89704c6303732fc43a12699b">修改配置文件<code>bookstore-api.yaml</code>，增加如下内容</li></ul><card type="block" name="codeblock" value="data:%7B%22id%22%3A%221ef49216%22%2C%22mode%22%3A%22yaml%22%2C%22code%22%3A%22Add%3A%5Cn%20%20Etcd%3A%5Cn%20%20%20%20Hosts%3A%5Cn%20%20%20%20%20%20-%20localhost%3A2379%5Cn%20%20%20%20Key%3A%20add.rpc%5CnCheck%3A%5Cn%20%20Etcd%3A%5Cn%20%20%20%20Hosts%3A%5Cn%20%20%20%20%20%20-%20localhost%3A2379%5Cn%20%20%20%20Key%3A%20check.rpc%22%7D"></card><ul data-lake-id="97e47ec595e19275b5d5132e0b70ce0c"><li data-lake-id="968e13df6bb0b2cca099db0dd4b49da1">通过etcd自动去发现可用的add/check服务</li><li data-lake-id="265133fd82543d72b88c353cc685d447">修改<code>internal/config/config.go</code>如下，增加add/check服务依赖</li></ul><card type="block" name="codeblock" value="data:%7B%22id%22%3A%227be3ff0a%22%2C%22mode%22%3A%22go%22%2C%22code%22%3A%22type%20Config%20struct%20%7B%5Cn%20%20%20%20rest.RestConf%5Cn%20%20%20%20Add%20%20%20zrpc.RpcClientConf%20%20%20%20%20%2F%2F%20%E6%89%8B%E5%8A%A8%E4%BB%A3%E7%A0%81%5Cn%20%20%20%20Check%20zrpc.RpcClientConf%20%20%20%20%20%2F%2F%20%E6%89%8B%E5%8A%A8%E4%BB%A3%E7%A0%81%5Cn%7D%22%7D"></card><ul data-lake-id="46ce083bb883d6f0ec8b557d5619cc8e"><li data-lake-id="d5143f7fd694a624b762449e44d8fa58">修改<code>internal/svc/servicecontext.go</code>，如下：</li></ul><card type="block" name="codeblock" value="data:%7B%22id%22%3A%22850df8b9%22%2C%22mode%22%3A%22go%22%2C%22code%22%3A%22type%20ServiceContext%20struct%20%7B%5Cn%20%20%20%20Config%20%20config.Config%5Cn%20%20%20%20Adder%20%20%20adder.Adder%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E6%89%8B%E5%8A%A8%E4%BB%A3%E7%A0%81%5Cn%20%20%20%20Checker%20checker.Checker%20%20%20%20%20%20%2F%2F%20%E6%89%8B%E5%8A%A8%E4%BB%A3%E7%A0%81%5Cn%7D%5Cn%5Cnfunc%20NewServiceContext(c%20config.Config)%20*ServiceContext%20%7B%5Cn%20%20%20%20return%20%26ServiceContext%7B%5Cn%20%20%20%20%20%20%20%20Config%3A%20%20c%2C%5Cn%20%20%20%20%20%20%20%20Adder%3A%20%20%20adder.NewAdder(zrpc.MustNewClient(c.Add))%2C%20%20%20%20%20%20%20%20%20%2F%2F%20%E6%89%8B%E5%8A%A8%E4%BB%A3%E7%A0%81%5Cn%20%20%20%20%20%20%20%20Checker%3A%20checker.NewChecker(zrpc.MustNewClient(c.Check))%2C%20%20%20%2F%2F%20%E6%89%8B%E5%8A%A8%E4%BB%A3%E7%A0%81%5Cn%20%20%20%20%7D%5Cn%7D%22%7D"></card><ul data-lake-id="83a1a243ec78b00910519814ac8e9139"><li data-lake-id="052a854d5b87508305193bfb88c638f0">通过ServiceContext在不同业务逻辑之间传递依赖</li><li data-lake-id="05a91c82e412c6a8dfa9f2a4d41f4c89">修改<code>internal/logic/addlogic.go</code>里的<code>Add</code>方法，如下：</li></ul><card type="block" name="codeblock" value="data:%7B%22id%22%3A%22619d3a5c%22%2C%22mode%22%3A%22go%22%2C%22code%22%3A%22func%20(l%20*AddLogic)%20Add(req%20types.AddReq)%20(*types.AddResp%2C%20error)%20%7B%5Cn%20%20%20%20%2F%2F%20%E6%89%8B%E5%8A%A8%E4%BB%A3%E7%A0%81%E5%BC%80%E5%A7%8B%5Cn%20%20%20%20resp%2C%20err%20%3A%3D%20l.svcCtx.Adder.Add(l.ctx%2C%20%26adder.AddReq%7B%5Cn%20%20%20%20%20%20%20%20Book%3A%20%20req.Book%2C%5Cn%20%20%20%20%20%20%20%20Price%3A%20req.Price%2C%5Cn%20%20%20%20%7D)%5Cn%20%20%20%20if%20err%20!%3D%20nil%20%7B%5Cn%20%20%20%20%20%20%20%20return%20nil%2C%20err%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20return%20%26types.AddResp%7B%5Cn%20%20%20%20%20%20%20%20Ok%3A%20resp.Ok%2C%5Cn%20%20%20%20%7D%2C%20nil%5Cn%20%20%20%20%2F%2F%20%E6%89%8B%E5%8A%A8%E4%BB%A3%E7%A0%81%E7%BB%93%E6%9D%9F%5Cn%7D%22%7D"></card><ul data-lake-id="a26d59e2b66ef8d910f6c434923821c7"><li data-lake-id="4acf9b99043f92a4e68de59d1ac2d037">通过调用<code>adder</code>的<code>Add</code>方法实现添加图书到bookstore系统</li><li data-lake-id="76e5edee168ea073ab5582014f5f9e77">修改<code>internal/logic/checklogic.go</code>里的<code>Check</code>方法，如下：</li></ul><card type="block" name="codeblock" value="data:%7B%22id%22%3A%22c511e798%22%2C%22mode%22%3A%22go%22%2C%22code%22%3A%22func%20(l%20*CheckLogic)%20Check(req%20types.CheckReq)%20(*types.CheckResp%2C%20error)%20%7B%5Cn%20%20%20%20%2F%2F%20%E6%89%8B%E5%8A%A8%E4%BB%A3%E7%A0%81%E5%BC%80%E5%A7%8B%5Cn%20%20%20%20resp%2C%20err%20%3A%3D%20l.svcCtx.Checker.Check(l.ctx%2C%20%26checker.CheckReq%7B%5Cn%20%20%20%20%20%20%20%20Book%3A%20%20req.Book%2C%5Cn%20%20%20%20%7D)%5Cn%20%20%20%20if%20err%20!%3D%20nil%20%7B%5Cn%20%20%20%20%20%20%20%20logx.Error(err)%5Cn%20%20%20%20%20%20%20%20return%20%26types.CheckResp%7B%7D%2C%20err%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20return%20%26types.CheckResp%7B%5Cn%20%20%20%20%20%20%20%20Found%3A%20resp.Found%2C%5Cn%20%20%20%20%20%20%20%20Price%3A%20resp.Price%2C%5Cn%20%20%20%20%7D%2C%20nil%5Cn%20%20%20%20%2F%2F%20%E6%89%8B%E5%8A%A8%E4%BB%A3%E7%A0%81%E7%BB%93%E6%9D%9F%5Cn%7D%22%7D"></card><ul data-lake-id="c3c1fd46aba5e49790985e398fd97562"><li data-lake-id="0e14b5ca876f610c4905a5757980958e">通过调用<code>checker</code>的<code>Check</code>方法实现从bookstore系统中查询图书的价格</li></ul><p data-lake-id="c3c8885a40b51e7d349fb4ce1127a336"><br /></p><h2 id="c732138a" data-lake-id="f9919c226ba25cc354ae655b8908b7c4">9. 定义数据库表结构，并生成CRUD+cache代码</h2><p data-lake-id="34b4ca918e20b42181343c61f55bfc53"><br /></p><ul data-lake-id="61eed6ea5c65959884c2c09779a616c8"><li data-lake-id="a2a53c5ce7ab4d85af7366c635b99496">bookstore下创建<code>rpc/model</code>目录：<code>mkdir -p rpc/model</code></li><li data-lake-id="dfcc0faa96f400cf3a1124483ac1e148">在rpc/model目录下编写创建book表的sql文件<code>book.sql</code>，如下：</li></ul><card type="block" name="codeblock" value="data:%7B%22id%22%3A%221f6851d3%22%2C%22mode%22%3A%22sql%22%2C%22code%22%3A%22CREATE%20TABLE%20%60book%60%5Cn(%5Cn%20%20%60book%60%20varchar(255)%20NOT%20NULL%20COMMENT%20\'book%20name\'%2C%5Cn%20%20%60price%60%20int%20NOT%20NULL%20COMMENT%20\'book%20price\'%2C%5Cn%20%20PRIMARY%20KEY(%60book%60)%5Cn)%20ENGINE%3DInnoDB%20DEFAULT%20CHARSET%3Dutf8mb4%3B%22%7D"></card><ul data-lake-id="9f7dd1a03dacd5afb956ac44e14266d2"><li data-lake-id="8a2b8f4d05dca010a46e2d3327d265a8">创建DB和table</li></ul><card type="block" name="codeblock" value="data:%7B%22id%22%3A%225694c3ab%22%2C%22mode%22%3A%22sql%22%2C%22code%22%3A%22create%20database%20gozero%3B%22%7D"></card><card type="block" name="codeblock" value="data:%7B%22id%22%3A%222f9875e5%22%2C%22mode%22%3A%22sql%22%2C%22code%22%3A%22source%20book.sql%3B%22%7D"></card><ul data-lake-id="45a8ffabb58e9bcc7f4c37bbfc55b209"><li data-lake-id="11cde7313f410f34dbe3d971fc02ee87">在<code>rpc/model</code>目录下执行如下命令生成CRUD+cache代码，<code>-c</code>表示使用<code>redis cache</code></li></ul><card type="block" name="codeblock" value="data:%7B%22id%22%3A%225a0a44fa%22%2C%22mode%22%3A%22shell%22%2C%22code%22%3A%22goctl%20model%20mysql%20ddl%20-c%20-src%20book.sql%20-dir%20.%22%7D"></card><ul data-lake-id="720d61f463cc73cbb9358323f1160086"><li data-lake-id="816fd46ac476669a9d82909016a14303">也可以用<code>datasource</code>命令代替<code>ddl</code>来指定数据库链接直接从schema生成<br />生成后的文件结构如下：</li></ul><card type="block" name="codeblock" value="data:%7B%22id%22%3A%22c5beb3d3%22%2C%22mode%22%3A%22plain%22%2C%22code%22%3A%22rpc%2Fmodel%5Cn%E2%94%9C%E2%94%80%E2%94%80%20book.sql%5Cn%E2%94%9C%E2%94%80%E2%94%80%20bookstoremodel.go%20%20%20%20%20%2F%2F%20CRUD%2Bcache%E4%BB%A3%E7%A0%81%5Cn%E2%94%94%E2%94%80%E2%94%80%20vars.go%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E5%AE%9A%E4%B9%89%E5%B8%B8%E9%87%8F%E5%92%8C%E5%8F%98%E9%87%8F%22%7D"></card><p data-lake-id="62ea2a97a6f7b8b9056988ff7bd6530f"><br /></p><h2 id="57deb9b0" data-lake-id="333f45064bcc5caaa20020959ccbc8b6">10. 修改add/check rpc代码调用crud+cache代码</h2><p data-lake-id="8c9dd4aa249cffbcefc0d9c2f7801f09"><br /></p><ul data-lake-id="1c4b708e8a9e297264d4652d9eed65b4"><li data-lake-id="0b64b4155403ac94207de9a39af42128">修改<code>rpc/add/etc/add.yaml</code>和<code>rpc/check/etc/check.yaml</code>，增加如下内容：</li></ul><card type="block" name="codeblock" value="data:%7B%22id%22%3A%22f4da847c%22%2C%22mode%22%3A%22yaml%22%2C%22code%22%3A%22DataSource%3A%20root%3A%40tcp(localhost%3A3306)%2Fgozero%5CnTable%3A%20book%5CnCache%3A%5Cn%20%20-%20Host%3A%20localhost%3A6379%22%7D"></card><ul data-lake-id="9bf8f78dabbd7a106e87b54f24f70b4c"><li data-lake-id="d15a02d6e192ca771f178dd9e566cbcb">可以使用多个redis作为cache，支持redis单点或者redis集群</li><li data-lake-id="50c9e13ee9590b2cda501d73c881d00a">修改<code>rpc/add/internal/config.go</code>和<code>rpc/check/internal/config.go</code>，如下：</li></ul><card type="block" name="codeblock" value="data:%7B%22id%22%3A%22375e75e4%22%2C%22mode%22%3A%22go%22%2C%22code%22%3A%22type%20Config%20struct%20%7B%5Cn%20%20%20%20zrpc.RpcServerConf%5Cn%20%20%20%20DataSource%20string%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E6%89%8B%E5%8A%A8%E4%BB%A3%E7%A0%81%5Cn%20%20%20%20Cache%20%20%20%20%20%20cache.CacheConf%20%20%20%20%2F%2F%20%E6%89%8B%E5%8A%A8%E4%BB%A3%E7%A0%81%5Cn%7D%22%7D"></card><ul data-lake-id="3a95543c23089414b8d55935d164a8d0"><li data-lake-id="89ec8266295e4cfa37686399f4c90069">增加了mysql和redis cache配置</li><li data-lake-id="571a3c65d413a0576555ea6149530cce">修改<code>rpc/add/internal/svc/servicecontext.go</code>和<code>rpc/check/internal/svc/servicecontext.go</code>，如下：</li></ul><card type="block" name="codeblock" value="data:%7B%22id%22%3A%2267edaf87%22%2C%22mode%22%3A%22go%22%2C%22code%22%3A%22type%20ServiceContext%20struct%20%7B%5Cn%20%20%20%20c%20%20%20%20%20config.Config%5Cn%20%20%20%20Model%20model.BookModel%20%20%20%2F%2F%20%E6%89%8B%E5%8A%A8%E4%BB%A3%E7%A0%81%5Cn%7D%5Cn%5Cnfunc%20NewServiceContext(c%20config.Config)%20*ServiceContext%20%7B%5Cn%20%20%20%20return%20%26ServiceContext%7B%5Cn%20%20%20%20%20%20%20%20c%3A%20%20%20%20%20%20%20%20%20%20%20%20%20c%2C%5Cn%20%20%20%20%20%20%20%20Model%3A%20model.NewBookModel(sqlx.NewMysql(c.DataSource)%2C%20c.Cache)%2C%20%2F%2F%20%E6%89%8B%E5%8A%A8%E4%BB%A3%E7%A0%81%5Cn%20%20%20%20%7D%5Cn%7D%22%7D"></card><ul data-lake-id="1de77ae8dd89f39de298e626e7093083"><li data-lake-id="4b8e235e73e212453a3862691afb2bc8">修改<code>rpc/add/internal/logic/addlogic.go</code>，如下：</li></ul><card type="block" name="codeblock" value="data:%7B%22id%22%3A%222fb3a45e%22%2C%22mode%22%3A%22go%22%2C%22code%22%3A%22func%20(l%20*AddLogic)%20Add(in%20*add.AddReq)%20(*add.AddResp%2C%20error)%20%7B%5Cn%20%20%20%20%2F%2F%20%E6%89%8B%E5%8A%A8%E4%BB%A3%E7%A0%81%E5%BC%80%E5%A7%8B%5Cn%20%20%20%20_%2C%20err%20%3A%3D%20l.svcCtx.Model.Insert(model.Book%7B%5Cn%20%20%20%20%20%20%20%20Book%3A%20%20in.Book%2C%5Cn%20%20%20%20%20%20%20%20Price%3A%20in.Price%2C%5Cn%20%20%20%20%7D)%5Cn%20%20%20%20if%20err%20!%3D%20nil%20%7B%5Cn%20%20%20%20%20%20%20%20return%20nil%2C%20err%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20return%20%26add.AddResp%7B%5Cn%20%20%20%20%20%20%20%20Ok%3A%20true%2C%5Cn%20%20%20%20%7D%2C%20nil%5Cn%20%20%20%20%2F%2F%20%E6%89%8B%E5%8A%A8%E4%BB%A3%E7%A0%81%E7%BB%93%E6%9D%9F%5Cn%7D%22%7D"></card><ul data-lake-id="2671c72d6bf19024351423383ef8025e"><li data-lake-id="8b8a0f9b1a0ecc8e604514825857048a">修改<code>rpc/check/internal/logic/checklogic.go</code>，如下：</li></ul><card type="block" name="codeblock" value="data:%7B%22id%22%3A%221757095e%22%2C%22mode%22%3A%22go%22%2C%22code%22%3A%22func%20(l%20*CheckLogic)%20Check(in%20*check.CheckReq)%20(*check.CheckResp%2C%20error)%20%7B%5Cn%20%20%20%20%2F%2F%20%E6%89%8B%E5%8A%A8%E4%BB%A3%E7%A0%81%E5%BC%80%E5%A7%8B%5Cn%20%20%20%20resp%2C%20err%20%3A%3D%20l.svcCtx.Model.FindOne(in.Book)%5Cn%20%20%20%20if%20err%20!%3D%20nil%20%7B%5Cn%20%20%20%20%20%20%20%20return%20nil%2Cerr%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20return%20%26check.CheckResp%7B%5Cn%20%20%20%20%20%20%20%20Found%3A%20true%2C%5Cn%20%20%20%20%20%20%20%20Price%3A%20resp.Price%2C%5Cn%20%20%20%20%7D%2C%20nil%5Cn%20%20%20%20%2F%2F%20%E6%89%8B%E5%8A%A8%E4%BB%A3%E7%A0%81%E7%BB%93%E6%9D%9F%5Cn%7D%22%7D"></card><ul data-lake-id="0ff0ee134a9dd74f978fda2360ce1db4"><li data-lake-id="16db8dd8a7cb1f991c4cbdd6a321d220">至此代码修改完成，凡是手动修改的代码我加了标注</li></ul><p data-lake-id="d8b064bcff811e74e7558ddf0916f203"><br /></p><h2 id="2cce9fad" data-lake-id="c9927b84e5b66070dc104d8cf0294b4a">11. 完整调用演示</h2><p data-lake-id="81a10877c4ca1e2dc1d47b8db0a7cfd2"><br /></p><ul data-lake-id="57aae2b5a377415af9127e0dc70a2a1e"><li data-lake-id="12ca70de30e265a0107ed673d80c577a">add api调用</li></ul><card type="block" name="codeblock" value="data:%7B%22id%22%3A%229d9261a7%22%2C%22mode%22%3A%22shell%22%2C%22code%22%3A%22curl%20-i%20%5C%22http%3A%2F%2Flocalhost%3A8888%2Fadd%3Fbook%3Dgo-zero%26price%3D10%5C%22%22%7D"></card><ul data-lake-id="e14f59ac3c074382b6863784fbe5a492"><li data-lake-id="355b0bc7556547347957080a4a678867">返回如下：</li></ul><card type="block" name="codeblock" value="data:%7B%22id%22%3A%2269e13938%22%2C%22mode%22%3A%22http%22%2C%22code%22%3A%22HTTP%2F1.1%20200%20OK%5CnContent-Type%3A%20application%2Fjson%5CnDate%3A%20Thu%2C%2003%20Sep%202020%2009%3A42%3A13%20GMT%5CnContent-Length%3A%2011%5Cn%5Cn%7B%5C%22ok%5C%22%3Atrue%7D%22%7D"></card><ul data-lake-id="fe1944026bfff5a485fe9ec6bfdc776f"><li data-lake-id="d42e2fb76d1c917dbdffe049b6d97a95">check api调用</li></ul><card type="block" name="codeblock" value="data:%7B%22id%22%3A%220d3bfb86-1%22%2C%22mode%22%3A%22shell%22%2C%22code%22%3A%22curl%20-i%20%5C%22http%3A%2F%2Flocalhost%3A8888%2Fcheck%3Fbook%3Dgo-zero%5C%22%22%7D"></card><ul data-lake-id="a9de884f637ac0f95e8451e48b3128af"><li data-lake-id="021e35c0ba3221900276ec7ab9ec42c3">返回如下：</li></ul><card type="block" name="codeblock" value="data:%7B%22id%22%3A%2207ca3305%22%2C%22mode%22%3A%22http%22%2C%22code%22%3A%22HTTP%2F1.1%20200%20OK%5CnContent-Type%3A%20application%2Fjson%5CnDate%3A%20Thu%2C%2003%20Sep%202020%2009%3A47%3A34%20GMT%5CnContent-Length%3A%2025%5Cn%5Cn%7B%5C%22found%5C%22%3Atrue%2C%5C%22price%5C%22%3A10%7D%22%7D"></card><p data-lake-id="cfbec31ccf3aab5194312c10412e7665"><br /></p><h2 id="00b98626" data-lake-id="7635e997cf36e47ab7ca2b8716bd5a69">12. Benchmark</h2><p data-lake-id="e259645406385098b844411b6a8c6d2c"><br /></p><p data-lake-id="7a67bdcf50ec909f82cd50df365c8a1b">因为写入依赖于mysql的写入速度，就相当于压mysql了，所以压测只测试了check接口，相当于从mysql里读取并利用缓存，为了方便，直接压这一本书，因为有缓存，多本书也是一样的，对压测结果没有影响。</p><p data-lake-id="3f827bfbcfe28cb011738420e81c6b67"><br /></p><p data-lake-id="c99ea8ad693d706c96549bd011fb64df">压测之前，让我们先把打开文件句柄数调大：</p><p data-lake-id="2746e8ece08b9f1132f9b7a70ab13a30"><br /></p><card type="block" name="codeblock" value="data:%7B%22id%22%3A%226a8d550f%22%2C%22mode%22%3A%22shel%22%2C%22code%22%3A%22ulimit%20-n%2020000%22%7D"></card><p data-lake-id="1f65273e572abecca0d285661da0b55e"><br /></p><p data-lake-id="0775006475e79f14aab4cc3f49e1b0e2">并日志的等级改为<code>error</code>，防止过多的info影响压测结果，在每个yaml配置文件里加上如下：</p><p data-lake-id="a5e4e69517ff84f3f00d724f8a030edb"><br /></p><card type="block" name="codeblock" value="data:%7B%22id%22%3A%22e75d7584%22%2C%22mode%22%3A%22yaml%22%2C%22code%22%3A%22Log%3A%5Cn%5CtLevel%3A%20error%22%7D"></card><p data-lake-id="043cc3da58204253ce3f5f81de8ec703"><br /></p><p data-lake-id="3ceb7a234928888b734f9c3cdbb7fb67"><card type="inline" name="image" value="data:%7B%22src%22%3A%22..%2F..%2Fdoc%2Fimages%2Fbookstore-benchmark.png%22%2C%22alt%22%3A%22Benchmark%22%7D"></card></p><p data-lake-id="6b96b3f7338311a5cea67102f31b0515"><br /></p><p data-lake-id="090f35d0c04af1b2cf39c578037b723d">可以看出在我的MacBook Pro上能达到3万+的qps。</p><p data-lake-id="2d6bf7267e056ce5fd9ed07d2214e8e6"><br /></p><h2 id="e033325b" data-lake-id="939585dd448ee0a6d64e74e3c3280ed0">13. 完整代码</h2><p data-lake-id="947e2e0ac6a579637171afa3312a3ff5"><br /></p><p data-lake-id="2c119997afbdd980a80a5449e6b374de"><a href="https://github.com/tal-tech/go-zero/tree/master/example/bookstore" target="_blank">https://github.com/tal-tech/go-zero/tree/master/example/bookstore</a></p><p data-lake-id="659c0e3dd577dd456c9b7da65ff035cd"><br /></p><h2 id="59faccf0" data-lake-id="ada2b9bb0758d8b7650dc30dab461079">14. 总结</h2><p data-lake-id="39b54a887215d13e66d329efa36cd1df"><br /></p><p data-lake-id="dc39f631e9bff8ff574af4be8a3d92f9">我们一直强调<strong>工具大于约定和文档</strong>。</p><p data-lake-id="dd4edce980c452a4203d2f4e4270edf2"><br /></p><p data-lake-id="62fdabd9b691512ece790e754bd70c4a">go-zero不只是一个框架，更是一个建立在框架+工具基础上的，简化和规范了整个微服务构建的技术体系。</p><p data-lake-id="2cca9be745a60154d4d9e2857ef39de3"><br /></p><p data-lake-id="73661765791ad44663b8be85f195176d">我们在保持简单的同时也尽可能把微服务治理的复杂度封装到了框架内部，极大的降低了开发人员的心智负担，使得业务开发得以快速推进。</p><p data-lake-id="8c6b5e5de4fcd2ac3e3880a79fbceb1f"><br /></p><p data-lake-id="43a297dcac4e64d3ba260a0c581d1be5">通过go-zero+goctl生成的代码，包含了微服务治理的各种组件，包括：并发控制、自适应熔断、自适应降载、自动缓存控制等，可以轻松部署以承载巨大访问量。</p><p data-lake-id="d63d0f944b4adadb7fb3241a990da665"><br /></p><p data-lake-id="83b463d637e39c66315545d9ecf7870d">有任何好的提升工程效率的想法，随时欢迎交流！👏</p>',
        UB7nay: '<!doctype lake><meta name="doc-version" content="1" /><meta name="viewport" content="fixed" /><meta name="typography" content="classic" /><p data-lake-id="a20d224c568e48b9d67847a2c66a8c01_p_0" style="text-align: left;">SELinux(Security Enhance Linux)是安全加强的Linux，SELinux其实在90年代初期甚至之前诞生时间相当早但是真正公开的时间并不是特别长，90年代初期在NSA(美国国家安全署)中的一位研究员手中，最开始的理念是为了实现进程在运行的时候具有最小单元集合而进行的并且那个有一个很重要的可行计算分级方式将操作系统的安全级别分为C1，C2，B1，B2，A1。数字越大安全级别越低所以C2的级别比C1的级别低同时字母在字母表中越靠上级别越高所以C1 低于B3如此排序，Linux、Window一般都是C2级别的安全性。</p><p data-lake-id="0d90aefdfda90c3c0228304a0489786d" style="text-align: left;">当没有SELinux时候 Linux安全级别并不比Window高 之所以Linux不容易中毒并不是安全级别高其实是上面可执行的程序较少只是减少了攻击的可能性这并不意味着真正安全</p><p data-lake-id="5ef0ca89df2392252a8eb1b8460836ac" style="text-align: left;">由于设计的初衷是让进程具备最小运行单元集合下，为了能让这此安全策略得以实施必须要和某一个操作系统内核结合起来后才能实现其完整的功能，于是NAS不得不找一个商业的操作系统来合作这就意味着操作系统厂商必须要把自己的内核源代码公开给SELinux项目，当时的操作系统厂商靠人力及财力发明的操作的系统几乎不可能乐意贡献给第三方，由于Linux遵循GUN协议源代码本身就是开源的，在2000年SELinux揉和进了Linux内核</p><p data-lake-id="97a30b7e2c13efb05d752685d29fb5f5" style="text-align: left;"><strong>SELinux工作模型：</strong></p><p data-lake-id="35b93b2e2e5491e6913b363a2e3be365" style="text-align: left;">此前讲过Linux的安全模型，关于进程运行的概念，SELinux的工作模式与之类似简单来讲就是Subject Action Object</p><p data-lake-id="815c3dc2fbfe5b36a7d3571dfdf39866" style="text-align: left;">控制进程由某一个主题所发出的指令动作操作某一个对象级别的安全，当运行某一个进程的时候会在内核空间创建一个沙箱，所有操作都在沙箱中完成</p><p data-lake-id="532715d376c20de290a776f4ce6b26f6" style="text-indent: 28px; text-align: left;">Strict Model：严格模型任何进程要想运行都必须接受SELinux控制</p><p data-lake-id="ddf0318a86b4ad999c1b551190550d78" style="text-indent: 28px; text-align: left;">Target Model：目标模型并非控制每一个进程只控制一部分进程比如：httpd，nfs等</p><p data-lake-id="c0184e9f705b6117c16f691e5a67d5da" style="text-align: left;">SELinux使用起来比较麻烦，完全深入了解没什么必要，大概讲讲SELinux是什么及怎么工作的和两种模型即可，之所以写这篇是因为后续会有安全密码相关的知识和简单认识到操作系统安全方面的知识</p><p data-lake-id="94843007d5597af9d9a2b0be12abc69c" style="text-align: left;"><br /></p>',
        qQNzaq: '<!doctype lake><meta name="doc-version" content="1" /><meta name="viewport" content="fixed" /><meta name="typography" content="classic" /><p data-lake-id="a20d224c568e48b9d67847a2c66a8c01_p_0" style="text-align: left;">iptables和netfilter是一组网络防火墙工具，netfilter是一个规则过滤框架，iptables是一个生成规则并且可以附在netfilter上实现数据报文，NAT，mangle的工具，在说网络防火墙之前需要先了解一下网络相关的知识，网络本身是一门很复杂本篇也不可能完全讲的清楚，这里凭借着几年前研究LVS的知识简单说说tcp ip报文首部。</p><p data-lake-id="e713b6c384fc585742638fcd1a2e2e3e" style="text-align: left;"><strong>ip报文首部</strong></p><p data-lake-id="e83438ed0ca55e45c8445b4be2c92e32" style="text-align: left;"><br /></p><p data-lake-id="3dcd694ef1c1c67d418613077d8282f5" style="background-color: transparent; text-align: left;"><card type="inline" name="image" value="data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2020%2Fpng%2F1640702%2F1608980521531-f004d3ad-93c1-4997-9ed1-4b4d813c572a.png%22%2C%22originWidth%22%3A862%2C%22originHeight%22%3A510%2C%22name%22%3A%22image.png%22%2C%22size%22%3A932507%2C%22display%22%3A%22inline%22%2C%22align%22%3A%22left%22%2C%22linkTarget%22%3A%22_blank%22%2C%22status%22%3A%22done%22%2C%22ocrLocations%22%3A%5B%7B%22x%22%3A332.66226%2C%22y%22%3A7.7900143%2C%22width%22%3A161.86156999999997%2C%22height%22%3A28.7160457%2C%22text%22%3A%22IPHEader%22%7D%2C%7B%22x%22%3A301.53384%2C%22y%22%3A33.568302%2C%22width%22%3A225.84156000000002%2C%22height%22%3A19.930653%2C%22text%22%3A%22RFC791-InfernalProtocol%22%7D%2C%7B%22x%22%3A172.8154%2C%22y%22%3A59.763927%2C%22width%22%3A577.1922999999999%2C%22height%22%3A27.705702999999993%2C%22text%22%3A%22%E7%AB%968620121232252822820%22%7D%2C%7B%22x%22%3A528.2024%2C%22y%22%3A86.71943%2C%22width%22%3A117.58730000000003%2C%22height%22%3A21.953536%2C%22text%22%3A%22TotalLength%22%7D%2C%7B%22x%22%3A110.06623%2C%22y%22%3A89.763214%2C%22width%22%3A60.83782000000001%2C%22height%22%3A16.036546%2C%22text%22%3A%22IPversion%22%7D%2C%7B%22x%22%3A201.69159%2C%22y%22%3A89.79457%2C%22width%22%3A42.647160000000014%2C%22height%22%3A14.511790000000005%2C%22text%22%3A%22HdrLen%22%7D%2C%7B%22x%22%3A272.91156%2C%22y%22%3A88.24551%2C%22width%22%3A144.34044%2C%22height%22%3A23.14376%2C%22text%22%3A%22TypeofService(Tos)%22%7D%2C%7B%22x%22%3A120.825584%2C%22y%22%3A106.44989%2C%22width%22%3A40.969995999999995%2C%22height%22%3A12.333660000000009%2C%22text%22%3A%22(4bits)%22%7D%2C%7B%22x%22%3A557.86615%2C%22y%22%3A107.36786%2C%22width%22%3A59.032350000000065%2C%22height%22%3A15.329474000000005%2C%22text%22%3A%22(16bits)%22%7D%2C%7B%22x%22%3A317.0322%2C%22y%22%3A107.48008%2C%22width%22%3A50.904300000000035%2C%22height%22%3A15.145669999999996%2C%22text%22%3A%22(8bits)%22%7D%2C%7B%22x%22%3A131.71371%2C%22y%22%3A139.30263%2C%22width%22%3A262.80652000000003%2C%22height%22%3A21.487040000000007%2C%22text%22%3A%22Identification(FragmentID)%22%7D%2C%7B%22x%22%3A540.9707%2C%22y%22%3A140.75868%2C%22width%22%3A160.11390000000006%2C%22height%22%3A16.801680000000005%2C%22text%22%3A%22FRagmentOFfset%22%7D%2C%7B%22x%22%3A591.49554%2C%22y%22%3A157.38855%2C%22width%22%3A60.359320000000025%2C%22height%22%3A15.182369999999992%2C%22text%22%3A%22(13bits)%22%7D%2C%7B%22x%22%3A234.04141%2C%22y%22%3A159.19199%2C%22width%22%3A59.89251999999996%2C%22height%22%3A14.546580000000006%2C%22text%22%3A%22(16bits)%22%7D%2C%7B%22x%22%3A785.1048%2C%22y%22%3A169.48367%2C%22width%22%3A16.81460000000004%2C%22height%22%3A16.81460000000004%2C%22text%22%3A%22sonaoz%22%7D%2C%7B%22x%22%3A504.83618%2C%22y%22%3A189.46254%2C%22width%22%3A175.42341999999996%2C%22height%22%3A18.53284000000002%2C%22text%22%3A%22HeaderChecksum%22%7D%2C%7B%22x%22%3A124.72242%2C%22y%22%3A190.03969%2C%22width%22%3A122.20670000000001%2C%22height%22%3A21.416939999999983%2C%22text%22%3A%22TIme-To-Live(mL)%22%7D%2C%7B%22x%22%3A320.3831%2C%22y%22%3A192.67581%2C%22width%22%3A56.61179999999996%2C%22height%22%3A16.446439999999996%2C%22text%22%3A%22Protocol%22%7D%2C%7B%22x%22%3A562.2304%2C%22y%22%3A208.28015%2C%22width%22%3A60.260099999999966%2C%22height%22%3A13.513470000000012%2C%22text%22%3A%22(16bits)%22%7D%2C%7B%22x%22%3A322.20407%2C%22y%22%3A209.3297%2C%22width%22%3A52.874390000000005%2C%22height%22%3A16.506990000000002%2C%22text%22%3A%22(8bits)%22%7D%2C%7B%22x%22%3A175.96455%2C%22y%22%3A210.15182%2C%22width%22%3A34.04374999999999%2C%22height%22%3A15.084690000000023%2C%22text%22%3A%22bits)%22%7D%2C%7B%22x%22%3A344.40906%2C%22y%22%3A239.63567%2C%22width%22%3A177.10293999999993%2C%22height%22%3A20.34706%2C%22text%22%3A%22SourceIPAddress%22%7D%2C%7B%22x%22%3A42.281364%2C%22y%22%3A243.43947%2C%22width%22%3A14.102172999999993%2C%22height%22%3A14.102172999999993%2C%22text%22%3A%22SOKS%22%7D%2C%7B%22x%22%3A81.60908%2C%22y%22%3A249.54688%2C%22width%22%3A12.512649999999994%2C%22height%22%3A12.512649999999994%2C%22text%22%3A%22-N%22%7D%2C%7B%22x%22%3A400.8201%2C%22y%22%3A259.5435%2C%22width%22%3A60.14639999999997%2C%22height%22%3A14.944999999999993%2C%22text%22%3A%22(32bits)%22%7D%2C%7B%22x%22%3A323.65778%2C%22y%22%3A291.41638%2C%22width%22%3A220.03462000000002%2C%22height%22%3A20.69135%2C%22text%22%3A%22DestinationIPAddress%22%7D%2C%7B%22x%22%3A82.69396%2C%22y%22%3A296.86362%2C%22width%22%3A12.835309999999993%2C%22height%22%3A12.835309999999993%2C%22text%22%3A%22%E4%B8%80O%22%7D%2C%7B%22x%22%3A401.70557%2C%22y%22%3A311.882%2C%22width%22%3A62.12347%2C%22height%22%3A13.026399999999967%2C%22text%22%3A%22(32bits)%22%7D%2C%7B%22x%22%3A395.0816%2C%22y%22%3A342.40958%2C%22width%22%3A77.92220000000003%2C%22height%22%3A16.91962000000001%2C%22text%22%3A%22Options%22%7D%2C%7B%22x%22%3A84.0332%2C%22y%22%3A347.74118%2C%22width%22%3A15.813060000000007%2C%22height%22%3A15.813060000000007%2C%22text%22%3A%22.%22%7D%2C%7B%22x%22%3A206.75578%2C%22y%22%3A356.57147%2C%22width%22%3A455.95198000000005%2C%22height%22%3A20.029179999999997%2C%22text%22%3A%22(Hanyvariablelengthpaddedwitng)%22%7D%2C%7B%22x%22%3A70.5945%2C%22y%22%3A394.65094%2C%22width%22%3A11.65558%2C%22height%22%3A11.65558%2C%22text%22%3A%22%22%7D%2C%7B%22x%22%3A85.75645%2C%22y%22%3A396.85757%2C%22width%22%3A15.30623%2C%22height%22%3A15.30623%2C%22text%22%3A%22%E6%97%B6%22%7D%2C%7B%22x%22%3A413.38458%2C%22y%22%3A401.37265%2C%22width%22%3A45.30847%2C%22height%22%3A16.650879999999972%2C%22text%22%3A%22Data%22%7D%2C%7B%22x%22%3A323.0095%2C%22y%22%3A439.16415%2C%22width%22%3A239.22249999999997%2C%22height%22%3A23.395690000000002%2C%22text%22%3A%22101111161120212%22%7D%2C%7B%22x%22%3A90.58857%2C%22y%22%3A440.3756%2C%22width%22%3A23.188239999999993%2C%22height%22%3A20.38934999999998%2C%22text%22%3A%22Bit%22%7D%2C%7B%22x%22%3A511.66%2C%22y%22%3A432.81897%2C%22width%22%3A254.51223999999996%2C%22height%22%3A37.511690000000044%2C%22text%22%3A%2220122202526272229501%22%7D%5D%2C%22style%22%3A%22none%22%2C%22search%22%3A%22IPHEader%20RFC791-InfernalProtocol%20%E7%AB%968620121232252822820%20TotalLength%20IPversion%20HdrLen%20TypeofService(Tos)%20(4bits)%20(16bits)%20(8bits)%20Identification(FragmentID)%20FRagmentOFfset%20(13bits)%20(16bits)%20sonaoz%20HeaderChecksum%20TIme-To-Live(mL)%20Protocol%20(16bits)%20(8bits)%20bits)%20SourceIPAddress%20SOKS%20-N%20(32bits)%20DestinationIPAddress%20%E4%B8%80O%20(32bits)%20Options%20.%20(Hanyvariablelengthpaddedwitng)%20%20%E6%97%B6%20Data%20101111161120212%20Bit%2020122202526272229501%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%2C%22width%22%3A431%2C%22height%22%3A255%7D"></card></p><p data-lake-id="b1651d709847fb99e893e121e2b4ec7f" style="background-color: transparent; text-align: left;"><br /></p><p data-lake-id="50eb2a66b33ba1e79c597760595588dc" style="text-align: left;">Ip version：ip版本</p><p data-lake-id="df9cd8ae147e8aaa3e3034b3775c1adb" style="text-align: left;">Hdr Len：报文首部长度(实际上要乘以4才是真正首部长度)</p><p data-lake-id="33993a08705be31ba92d8ca9300563c4" style="text-align: left;">Type of Service：服务类型</p><p data-lake-id="9eb88cf1706840921bf08f2060feca12" style="text-align: left;">Total Length：报文总长度，报文总长度-首部长度=报文数据(对于ip报文来说数据里面包含了tcp首部，对于http协议数据里面应该也含有http首部对于ip来讲一律将其视为数据)</p><p data-lake-id="37e74968109a0d690c0545acce77ed6b" style="text-align: left;">Identification：段标识符，如果两个设备所支持的报文大小不相等需要对数据报文进行分片，当达到目标主机上根据段标识id相等判断进行合并分片</p><p data-lake-id="00c47942cb51b312efb5c4baf48011b8" style="text-indent: 28px; text-align: left;">MF：More Fragment更多分片</p><p data-lake-id="f0f41a2d6d3808c99d59067ea1f411ab" style="text-indent: 28px; text-align: left;">DF：Don\'t Fragment不允许分片，发不出去直接返回错误信息</p><p data-lake-id="566fefb3460f0e609d05f3153df837f0" style="text-indent: 28px; text-align: left;">R：</p><p data-lake-id="39d43e0375a5af05127151320f32f02e" style="text-align: left;">Fragment Offset：段偏移量，当合并分片的时候按照偏移量进行次序合并</p><p data-lake-id="ecde78ab04cd5658a22d4c4b8398d8f8" style="text-align: left;">Time-To-Live：生存时间，当报文发送至网络如果循环路由那么这个报文就会一直在网络上游荡，为了避免这种情况报文每经过一个路由将TTL值减1 直到为0如果还没有到达目标主机则丢弃</p><p data-lake-id="41a218e3cc4e0540b6bb828578f1199c" style="text-align: left;">Protocol：协议，标记不同协议类型</p><p data-lake-id="35b5fd542a151870593633d352ac0510" style="text-align: left;">Header Checksum：首部校验和，存放首部校验码客户端通过校验码校验报文的完整性</p><p data-lake-id="904317f5a1f102d6a3f91226389a2d3e" style="text-align: left;">Source IP Address：源ip</p><p data-lake-id="428ec0d92bb9a21e563e68dd31d7f581" style="text-align: left;">Destination IP Address：目标ip</p><p data-lake-id="aed1fcfbeee0300b76a16196ad8a789a" style="text-align: left;">Options：可变报文可变数据</p><p data-lake-id="3b0552137cb6a0af429c273778aae62f" style="text-align: left;">Data：数据</p><p data-lake-id="a12cff3483a71b2c1263126d653e0375" style="text-align: left;">ip首部控制将报文从一台主机发往另一台主机中间可能会经由很多设备比如路由器、交换机等等发往目标主机，最终通讯的就是两台主机的进程，通过靠ip地址和端口号区分主机的不同进程。所以众多的上层应用协议都是基于tcp或udp协议的再次封装以标记两台主机通讯的进程，于是有了tcp首部</p><p data-lake-id="6201ec293d91c918550826dc7d90efc3" style="text-align: left;"><strong>tcp报文首部</strong></p><p data-lake-id="d6ffb3597d69a07eff506f50764c1109" style="text-align: left;"><br /></p><p data-lake-id="8a993588bdef115788240052867a38e2" style="background-color: transparent; text-align: left;"><card type="inline" name="image" value="data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2020%2Fpng%2F1640702%2F1608980537521-77b8ff59-82b8-463d-b1eb-4d544dac46a4.png%22%2C%22originWidth%22%3A1022%2C%22originHeight%22%3A600%2C%22name%22%3A%22image.png%22%2C%22size%22%3A1132558%2C%22display%22%3A%22inline%22%2C%22align%22%3A%22left%22%2C%22linkTarget%22%3A%22_blank%22%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22search%22%3A%22%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%2C%22width%22%3A511%2C%22height%22%3A300%7D"></card></p><p data-lake-id="b4b4cc0188236a10be2b1abfecc034d8" style="background-color: transparent; text-align: left;"><br /></p><p data-lake-id="972e25ef11ff026000a2b7faf8999a63" style="text-align: left;">Source Port Number：源端口，(当数据报文流动方向不同是时候源端口和目标端口会发生翻转)</p><p data-lake-id="3b293574246d4ad4f9d711c3bb511597" style="text-align: left;">Destination Port NUmber：目标端口</p><p data-lake-id="e29857377291a14901bae3a7e7358ad2" style="text-align: left;">Sequence Number：序列号，tcp三次握手；发送方发送给接收方的编号</p><p data-lake-id="218d7b970db2440221e09a64e3423f75" style="text-align: left;">Acknowledgement Numer：确认号，接收方将发送方序列号+1并回复给发送方的确认编号</p><p data-lake-id="0f2fd973e47ad912c4fdf6e34490845f" style="text-align: left;">Header Length：报文首部长度</p><p data-lake-id="b21e9b619ceb3b89076b2cc14d8d2b82" style="text-align: left;">Reserved：保留位</p><p data-lake-id="eb5fddb701bfe8a96f0f8ce02cd39093" style="text-indent: 28px; text-align: left;">URG：紧急指针</p><p data-lake-id="534796d1b9ed448b64a6112c6e866695" style="text-indent: 28px; text-align: left;">ACK：报文确认号</p><p data-lake-id="97ab24cc2c6c8d2839a514380620a4e1" style="text-indent: 28px; text-align: left;">PSH：立即发送至缓冲区优先处理</p><p data-lake-id="94da86f35d2722f72ef802733f002cba" style="text-indent: 28px; text-align: left;">RST：重置</p><p data-lake-id="8416ed2d1ec03b5b1a8c56c974b04327" style="text-indent: 28px; text-align: left;">SYN：同步</p><p data-lake-id="aaa2a8332c522e2514085fddeb2ee75c" style="text-indent: 28px; text-align: left;">FIN：断开</p><p data-lake-id="1cd2f926549914f1d32a48630c5d3f76" style="text-align: left;">Window Size：窗口大小，滑动窗口，窗口接收报文字节大小</p><p data-lake-id="bec80bac67f07b7f48de9f6906a5a929" style="text-align: left;">TCP Checksum：报文校验码</p><p data-lake-id="44ae9acc27251d079f59e451cef0d641" style="text-align: left;">Urgent Pointer：紧急指针</p><p data-lake-id="4b2595b613db7e03584b7f4049c43edd" style="text-align: left;">OPtions：可选可变报文数据</p><p data-lake-id="ea5133c0381a1ebd38e11e3d9bf5707d" style="text-align: left;">Data：数据</p><p data-lake-id="5efef752a01f75a91e49f86793952dee" style="text-align: left;"><strong>iptables：</strong></p><p data-lake-id="1ae4ff76050a5676c5faa63bb2b21db9" style="text-indent: 28px; text-align: left;">iptables主要靠netfilter过滤表实现规则过滤，netfilter提供5个钩子函数分别工作在5个规则链上，</p><p data-lake-id="a21888d4b788c84d98c5b31d5083bcda" style="text-align: left;">input,output,prerouting,postrouting,forward，nat地址转换就是工作在prerouting，output和postrouting上</p><p data-lake-id="43221cc2ea7ec9b22a7e29391ba3bc25" style="text-align: left;">另外还有个mangle表，原理就是拆开报文首部进行修改最后重新组装</p><p data-lake-id="68d7cd1d08e0ced7b34cd579df6db243" style="text-align: left;">所以设置iptables最重要的是理解规则链和tcp ip报文，因为最终iptables是工作在规则链上将tcp ip网络报文进行过滤，关键的还是网络及tcp知识概念</p>',
        Yreiua: '<!doctype lake><meta name="doc-version" content="1" /><meta name="viewport" content="fixed" /><meta name="typography" content="classic" /><p data-lake-id="a20d224c568e48b9d67847a2c66a8c01_p_0" style="text-align: left;"> 在此之前已经说过Linux最早期为c语言静态语言所编写的，这里暂时不讨论gcc以及g++等编译器也不讨论configure、make、make install等支持静态语言编译过程。此前也说过Linux满足开源协议每个人可以进行源码编译想使用Linux也必须进行源码编译，Linux厂商为了源码管理以及使用方便便将户所需要的软件直接编译好打包成可执行的软件直接发布给用户安装。不同的 Linux 发行版使用不同的打包系统，一般而言，大多数发行版分别属于两大包管理技术阵营： Debian 的”.deb”，和 RedHat的”.rpm”。也有一些重要的例外，比方说 Gentoo， Slackware，和 Foresight，但大多数会使用这两个基本系统中的一个。这里将要介绍的是Red Hat系列发行版的RPM与YUM包管理器</p><p data-lake-id="3dd25bff07f9395d3ce7ebdfc2c98262" style="text-align: left;">        RPM命名“RedHat Package Manager”，简称则为RPM。这个机制最早由RedHat这家公司开发出来的，后来实在很好用，因此很多开发商就使用这个机制来作为软件安装的管理方式，包括Fedora，CentOS，SuSE等知名的开发商都是用它。</p><p data-lake-id="dfa7de012d0f188d7a65e94168079e7e" style="text-align: left;">        RPM最大的特点就是需要安装的软件已经编译过，并已经打包成RPM机制的安装包，通过里头默认的数据库记录这个软件安装时需要的依赖软件。当安装在你的Linux主机时，RPM会先依照软件里头的数据查询Linux主机的依赖属性软件是否满足，若满足则予以安装，若不满足则不予安装。</p><p data-lake-id="04965b8fc9d75558d5c6ad4b9ed3ed82" style="text-align: left;">        YUM可以看作是CS架构的软件，YUM的存在很好的解决了RPM的属性依赖问题。</p><p data-lake-id="4c7cc623584037781e569bb82287356b" style="text-align: left;">        YUM通过依赖rpm软件包管理器, 实现了rpm软件包管理器在功能上的扩展, 因此YUM是不能脱离rpm而独立运行的。</p><p data-lake-id="577c8b0f284cc90c38f65c5a4cabeaa2" style="text-align: left;">YUM可以同时配置多个资源库(Repository)、自动解决增加或删除rpm包时遇到的依赖性问题并且保持与RPM数据库的一致性等特点让用户使用起来极其方便而无需关心安装的软件所需的依赖问题</p><p data-lake-id="2a52bea1da8323ef219b28c383a0d970" style="text-align: left;">        当用户使用yum client端发起发起安装指令，Server端先对程序包进行分类后存储到不同repository容器中; 再通过收集到大量的rpm的数据库文件中程序包之间的依赖关系数据, 生成对应的依赖关系和所需文件在本地的存放位置的说明文件(.xml格式), 存放在本地的repodata目录下供Client端取用cilent端通过yum命令安装软件时发现缺少某些依赖性程序包, Client会根据本地的配置文件(/etc/yum.repos.d/*.repo)找到指定的Server端, 从Server端repo目录下获取说明文件xxx.xml后存储在本地/var/cache/yum中方便以后读取, 通过xxx.xml文件查找到需要安装的依赖性程序包在Server端的存放位置, 再进入Server端yum库中的指定repository容器中获取所需程序包, 下载完成后在本地实现安装。</p><p data-lake-id="774e79cc6280411043f75aa7f3c72e17" style="text-align: left;">虽然yum是你在联网后就能直接使用，不过如果系统的站点镜像没选择好，会导致连接速度非常慢！所以，这时候就需要我们去手动修改yum的设置文档了。</p><p data-lake-id="3a8ca08da7b7e1cfbe7514a83d49cf31" style="text-align: left;">        如你连接到CentOS的镜像站点（<a href="http://ftp.twaren.net/Linux/CentOS/7.3.1611/" target="_blank">http://ftp.twaren.net/Linux/CentOS/7.3.1611/</a>）后，就会发现里面有一堆链接，那些链接就是这个yum服务器所提供的容器了，包括centosplus、extras、fasttrack、os、updates等容器，最好认的就是os(系统默认的软件)与updates(软件升级版本)。</p><p data-lake-id="fae9b55250fd0c373b96525a86c3787b" style="text-align: left;">        在yum服务器的容器里面，最重要的一个目录就是那个“repodata”，该目录是分析RPM软件后所产生的软件依赖数据放置处。因此，当你找到容器所在网址时，最重要的就是该网址下面一定要有一个名为“repodata”的目录存在，那就是容器的网址了。</p><p data-lake-id="54f2e977086c991b7dd6061134315101" style="text-align: left;">使用命令：yum repolist all可以查看容器列表只有当最右边的status为enabled该容器才算激活。具体容器配置文件说明以及rpm，yum使用手册可自行查资料</p>',
        EVZVra: '<!doctype lake><meta name="doc-version" content="1" /><meta name="viewport" content="fixed" /><meta name="typography" content="classic" />\n' +
          '1.5-Linux vim编辑器及文件查找-文章<p><br /></p>',
        "6BRr2m": '<!doctype lake><meta name="doc-version" content="1" /><meta name="viewport" content="fixed" /><meta name="typography" content="classic" /><p data-lake-id="35f3667dff5afdcf226149f435b41c11">第二章讲过对于Linux而言一切皆文件，一切文件皆资源，Linux并没有默认权限，也就是说如果当前用户为最高级权限用户不小心该权限用户进行自杀式命令Linux不会进行自我阻止。早期Linux一个shell，一个内核总大小3-4M就能组成一个操作系统，不会存在过多垃圾文件干预用户形式的存在。这是Linux设计哲学思想之一。所以Linux提出了资源访问操作级别用来定义计算资源能力的访问，区别用户资源能力的控制，这就是权限。</p><p data-lake-id="a8d5ed2b08f4a0f4ec3f3a20f5a7fcea">Linux系统有很多权限首先要搞清楚两个重要的模型概念即权限模型和安全模型，其次相对每一个文件的权限粒度的切换控制和用户角度的shell式权限加载次序</p><p data-lake-id="c3384b7dbf40dc12f4b90fe675fe2ae4">权限模型：UGO/RWX。在Linux系统上每一个资源或服务的权限分别对应了三组用户的访问权限。对于用户而言权限就是获取计算机资源的凭证，而对于计算而言权限就是识别验证用户资源凭证。在计算机的内部定义某资源或文件权限的时候会映射三种权限标识即UGO。属主(U，user首字母)，属组(G，group首字母)，其他(O，other首字母)。假如有两位用户admin和root登录系统输入ls命令发起ls进程(命令是一个可执行文件，文件执行启动后成为进程故这里ls为进程)，同为ls命令，ls进程这时候会寻找哪一位用户发起的对应的属组属主权限。最终两位用户同样的命令发起同样的进程与之对应的权限一定不一样。所以命令发起的进程是否有权限取决于该用户属组属主的权限。</p><p data-lake-id="7ca9162079c04962aab6cc87f1648bc0">UGO分别对应三类权限RWX。三类权限三位一体。U对应着一组RWX，G对应着RWX，O对应着RWX。</p><p data-lake-id="f633d8a506d0fe0f694f014d5ffa2259">对于文件来讲R：可读，可以使用文本查看命令读取内容；W可写，可以使用文本编辑命令编辑或者删除文件；X可执行，可以适用命令提示符提交给内核执行。</p><p data-lake-id="24aa7497e101a8378df611e700f2a006">对于目录来讲R：可读，可以列出此目录下所有文件；W可写，可以在此目录下创建文件；X执行，可以切换进此目录，也可以查看内部文件的详细信息(没有X权限不能使用ls -l 列出详细信息)。</p><p data-lake-id="6541a13c6bb711b5520102d7849ac8cb">权限模型的三位一体分别用2进制表示每一位只有一种变化。如果说无权限用0表示，有权限用1表示</p><p data-lake-id="c18152d2624624931a2abe6f4fa6199b">000\t\t---；\t无权限</p><p data-lake-id="f2b5a3a1406b5714643156b5ca786e24">001\t\t--x；\t执行</p><p data-lake-id="8f9f51b6335934ceb3eca91e2b2bbe6d">010\t\t-x-；\t写</p><p data-lake-id="3b333553df3a0a9e4a83d617f7afe4ed">011\t\t-wx；\t写和执行</p><p data-lake-id="0a28a79ef43f93e6d3d1eedaec0afb5d">100\t\tr--；\t        只读</p><p data-lake-id="7d0b1c24b4e57f04cb019efc5303099f">101\t\tr-x；\t        读和执行</p><p data-lake-id="d28d8ac72c5ef071878a37938773574f">110\t\trw-；\t读写</p><p data-lake-id="3906f76e9a117508867be3fc5939e0f8">111\t\trwx；\t读写执行</p><p data-lake-id="094aae379cd22a9b34c506f995312607">2位二进制相当于4进制，3位二进制相当于8进制，4位二进制相当于16进制。如果将上面演算成8进制</p><p data-lake-id="d2ba65deb4831d35f81151f47b051a00">000\t\t---；\t无权限\t\t0(8进制表示)</p><p data-lake-id="41f4340ae641d308478eb3463d5af1b9">001\t\t--x；\t执行\t\t\t1</p><p data-lake-id="0b38937f5fb85e74c506db9dc8372450">010\t\t-x-；\t写\t\t\t2</p><p data-lake-id="3ab5c8d313d203f6dffc2b5784a5f4e8">011\t\t-wx；\t写和执行\t\t3</p><p data-lake-id="126646b626b7544a22dcd47d59f00db8">100\t\tr--；\t        只读\t\t\t4</p><p data-lake-id="c57f199b3d1db545c84bb446925be353">101\t\tr-x；\t        读和执行\t\t5</p><p data-lake-id="002cdcf389734dabe80d8285e42cd6b5">110\t\trw-；\t读写\t\t\t6</p><p data-lake-id="9f5fa0981560ae990d0a222ee9999101">111\t\trwx；\t读写执行\t\t7</p><p data-lake-id="1894ca79bbb4ecd9a1a4fbb8b29472c6">安全模型：也称作安全上下文。上面讲到，当不同的用户发起命令启动进程，而进程是用户操作计算机发起的代理，不同的用户同样的命令发起同样的进程最终是不同的进程代理。由内核来管理区分进程用户不同的代理权限称之为进程的安全上下文就是进程的安全模型。</p><p data-lake-id="8a06e1869d7483ca9bae4de0a3d32e3d">SUID和SUDO权限：首先来说SUID，上面讲到进程的安全模型。当用户发起命令启动进程，进程会根据用户的UGO权限来决定是否有权限。而当给某一资源或文件加上SUID那么这个进程或资源文件将会以自身附带的权限进行执行而不再根据用户启动的UGO权限来区分。有的时候权限是四位一体最前面就是SUID和sticky。SUID用s表示，sticky用t表示(sticky的作用可以通过设置在一个公共目录中每个人可以创建删除自己的文件却不能操作别人的文件)。SUDO在给某资源或文件执行的那一刻切换到另外一个用户身份所对应的该资源或文件的权限执行</p><p data-lake-id="f720890e419105bbea045a7c308361af">FACL权限：Filesystem Access Control List文件系统的访问控制列表。简单来讲就是利用文件系统的隐藏属性扩展属性保存额外的访问控制权限。访问控制权限可以再次或专门定义哪个用户或哪个组对当前文件有什么样的访问权限。前面讲过权限和安全模型。当用户发起一个进程，该进程就会寻找该用户对应的属主有没有该权限，没有的话就接着寻找该用户的属组在不在该进程下的基本组内。</p><p data-lake-id="365541fa0d3be92294f430176005b7d1">而当设定了facl访问控制列表后该进程就会寻找该用户对应的属主有没有该权限，没有的话会紧接着寻找facl列表中有没有该用户对应属主权限，接着会寻找该用户的属主在不在该进程的基本组内，最后会寻找facl列表中有没有该用户对应的属主在不在该进程的基本组内</p><p data-lake-id="aa4b28a7ab3388f75bebbb7447c189cf">从用户角度立场的shell权限：</p><p data-lake-id="f2a0ab0c34942ce97e23096bb82bb7a2">当用户通过某一终端登录，Linux就相当于打开一个shell图形界面发起一个进程。而shell本身就是一个可执行程序。可执行程序一定会依赖于某些配置文件。那当用户登录shell会默认加载哪些配置文件呢？从用户角度而言shell分为两种类型(这不是zsh，bash)</p><p data-lake-id="dfd59ccf028b3cb0f6d42399af375aaf">登录shell：有两种。第一种用户通过某终端输入账号密码登录的shell，第二种使用su - username、su -l username切换过去的。</p><p data-lake-id="be22b9417fedb69f858b69fd9bc60240">非登录shell：有三种。第一种使用su username没加 &quot;-&quot;以及&quot;- l&quot;选型登录的，第二种图形终端下打开的命令窗口。第三种，自动执行的shell脚本</p><p data-lake-id="d7b190a963f7f2da7547140839ee5174">这两类登录式shell在执行程序的时候会读取bash的配置文件</p><p data-lake-id="c5bc8cd0a17dc3d2888c4e0714644556">bash资源的配置分为两种，一种是全局配置，一种是用户配置。全局配置即对所有登录用户都生效用户配置只针对自己当前登录用户生效</p><p data-lake-id="11d625759f634be036627a043970234c">bash的全局配置文件路径在/etc/profile，/etc/profile.d/*.sh以及/etc/bashrc，个人配置文件路径在~/.bash_profile和 /.bashrc下。profile类的文件一般用来设定全局环境变量和运行命令或脚本，bashrc类的文件则用来设定本地变量以及命令别名。假如需要给Liunx设定别名如果是全局生效就修改/etc/bashrc配置文件，如果只是个人用户生效则修改/.bashrc。比如 通过 vim /etc/bashrc修改全局bashrc配置文件最后一行加上 alias cls=\'clear\' 则下次登录进入即生效 cls==clear效果</p><p data-lake-id="007eedfcecda6be03ff78d79f483451a">登录式shell会以此加载bash的配置文件----&gt; /etc/profile --&gt; /etc/profile.d/<em>.sh --&gt; ~/.bash_profile --&gt; ./bashrc --&gt; /etc/bashrc而非登录式shell则又会以此加载bash的配置的文件----&gt; ~/.bashrc --&gt; /etc/bashrc --&gt; /etc/profile.d/</em>.sh</p><p data-lake-id="059546ec764bdf345c68def3eda33eb5">Linux权限涉及的知识比较多，比如用户密码/etc/passwd，影子口令/etc/shadow，用户密码加密(单向加密，对称加密)等知识点需要自行积累。密码安全可参考另一系列&lt;密码安全&gt;笔记</p>',
        VryUR3: '<!doctype lake><meta name="doc-version" content="1" /><meta name="viewport" content="fixed" /><meta name="typography" content="classic" /><p data-lake-id="a20d224c568e48b9d67847a2c66a8c01_p_0" style="text-align: left;">Linux系统所有文件都是以文件形式存在，从跟目录&quot;/&quot;开始往下扩散开来</p><p data-lake-id="6c5922839bcbaa60316ff73f1e91827d" style="text-align: left;"><card type="inline" name="image" value="data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2020%2Fpng%2F1640702%2F1608980367715-826914a7-d009-45e5-9672-e6258b24eded.png%22%2C%22originWidth%22%3A1006%2C%22originHeight%22%3A694%2C%22name%22%3A%22image.png%22%2C%22size%22%3A660183%2C%22display%22%3A%22inline%22%2C%22align%22%3A%22left%22%2C%22linkTarget%22%3A%22_blank%22%2C%22status%22%3A%22done%22%2C%22ocrLocations%22%3A%5B%7B%22x%22%3A7.5987597%2C%22y%22%3A6.4690237%2C%22width%22%3A127.13714029999998%2C%22height%22%3A23.680793299999998%2C%22text%22%3A%22%E6%80%BB%E7%94%A8%E9%87%8F60%22%7D%2C%7B%22x%22%3A567.05994%2C%22y%22%3A38.88289%2C%22width%22%3A281.9284%2C%22height%22%3A23.249232%2C%22text%22%3A%2214%3A43bin-%3Eur%2Fbin%22%7D%2C%7B%22x%22%3A522.792%2C%22y%22%3A39.05626%2C%22width%22%3A31.470269999999914%2C%22height%22%3A22.345214%2C%22text%22%3A%2219%22%7D%2C%7B%22x%22%3A428.63358%2C%22y%22%3A39.21156%2C%22width%22%3A61.84674000000001%2C%22height%22%3A25.236349999999995%2C%22text%22%3A%2276%E6%9C%88%22%7D%2C%7B%22x%22%3A302.0456%2C%22y%22%3A40.707375%2C%22width%22%3A55.27535%2C%22height%22%3A22.068765%2C%22text%22%3A%22root%22%7D%2C%7B%22x%22%3A8.9341545%2C%22y%22%3A41.997437%2C%22width%22%3A146.58684549999998%2C%22height%22%3A18.582153000000005%2C%22text%22%3A%22Lrwxrwxrwx.%22%7D%2C%7B%22x%22%3A230.2867%2C%22y%22%3A41.83745%2C%22width%22%3A57.66719999999998%2C%22height%22%3A20.321400000000004%2C%22text%22%3A%22root%22%7D%2C%7B%22x%22%3A384.14752%2C%22y%22%3A71.79912%2C%22width%22%3A57.07391999999999%2C%22height%22%3A21.135890000000003%2C%22text%22%3A%224096%22%7D%2C%7B%22x%22%3A453.2788%2C%22y%22%3A72.07514%2C%22width%22%3A36.859050000000025%2C%22height%22%3A22.889020000000002%2C%22text%22%3A%226%E6%9C%88%22%7D%2C%7B%22x%22%3A647.1644%2C%22y%22%3A72.25982%2C%22width%22%3A59.658840000000055%2C%22height%22%3A21.566379999999995%2C%22text%22%3A%22boot%22%7D%2C%7B%22x%22%3A567.4854%2C%22y%22%3A72.3459%2C%22width%22%3A69.31859999999995%2C%22height%22%3A20.875829999999993%2C%22text%22%3A%2214%3A52%22%7D%2C%7B%22x%22%3A523.7464%2C%22y%22%3A72.72977%2C%22width%22%3A28.103500000000054%2C%22height%22%3A19.983975%2C%22text%22%3A%2219%22%7D%2C%7B%22x%22%3A201.78339%2C%22y%22%3A73.53062%2C%22width%22%3A15.692550000000011%2C%22height%22%3A15.692550000000011%2C%22text%22%3A%225%22%7D%2C%7B%22x%22%3A301.32297%2C%22y%22%3A73.27087%2C%22width%22%3A54.97588999999999%2C%22height%22%3A19.74053599999999%2C%22text%22%3A%22root%22%7D%2C%7B%22x%22%3A5.9793816%2C%22y%22%3A74.578384%2C%22width%22%3A150.9350184%2C%22height%22%3A18.698476%2C%22text%22%3A%22dr-xr-xr-x.%22%7D%2C%7B%22x%22%3A232.34164%2C%22y%22%3A75.054245%2C%22width%22%3A56.29473999999996%2C%22height%22%3A18.679055000000005%2C%22text%22%3A%22root%22%7D%2C%7B%22x%22%3A454.8276%2C%22y%22%3A103.18825%2C%22width%22%3A36.702%2C%22height%22%3A24.340860000000006%2C%22text%22%3A%226%E6%9C%88%22%7D%2C%7B%22x%22%3A383.90677%2C%22y%22%3A103.41752%2C%22width%22%3A56.04696999999999%2C%22height%22%3A22.124014000000003%2C%22text%22%3A%222960%22%7D%2C%7B%22x%22%3A523.25836%2C%22y%22%3A103.788086%2C%22width%22%3A29.60143999999991%2C%22height%22%3A21.085583999999997%2C%22text%22%3A%2225%22%7D%2C%7B%22x%22%3A564.72%2C%22y%22%3A104.264114%2C%22width%22%3A128.21206999999993%2C%22height%22%3A21.23990599999999%2C%22text%22%3A%2220%3A39dev%22%7D%2C%7B%22x%22%3A7.279867%2C%22y%22%3A105.955414%2C%22width%22%3A141.585973%2C%22height%22%3A19.948386%2C%22text%22%3A%22drwxr-xr-x%22%7D%2C%7B%22x%22%3A188.3485%2C%22y%22%3A105.679405%2C%22width%22%3A27.664780000000007%2C%22height%22%3A20.263504999999995%2C%22text%22%3A%2219%22%7D%2C%7B%22x%22%3A233.09369%2C%22y%22%3A106.22963%2C%22width%22%3A55.26723999999999%2C%22height%22%3A18.876099999999994%2C%22text%22%3A%22root%22%7D%2C%7B%22x%22%3A301.8777%2C%22y%22%3A106.29118%2C%22width%22%3A55.627369999999985%2C%22height%22%3A20.61211%2C%22text%22%3A%22root%22%7D%2C%7B%22x%22%3A523.2347%2C%22y%22%3A136.04558%2C%22width%22%3A29.434200000000033%2C%22height%22%3A21.919389999999993%2C%22text%22%3A%2226%22%7D%2C%7B%22x%22%3A455.1737%2C%22y%22%3A136.19423%2C%22width%22%3A34.77918%2C%22height%22%3A23.250349999999997%2C%22text%22%3A%226%E6%9C%88%22%7D%2C%7B%22x%22%3A566.52136%2C%22y%22%3A136.41599%2C%22width%22%3A70.08494000000007%2C%22height%22%3A21.048810000000003%2C%22text%22%3A%2210%3A41%22%7D%2C%7B%22x%22%3A383.33618%2C%22y%22%3A136.40768%2C%22width%22%3A57.069669999999974%2C%22height%22%3A19.62378000000001%2C%22text%22%3A%224096%22%7D%2C%7B%22x%22%3A6.5181675%2C%22y%22%3A137.27257%2C%22width%22%3A211.0864025%2C%22height%22%3A20.65132%2C%22text%22%3A%22drwxr-xr-x.101%22%7D%2C%7B%22x%22%3A232.7028%2C%22y%22%3A137.41571%2C%22width%22%3A55.797200000000004%2C%22height%22%3A20.469760000000008%2C%22text%22%3A%22root%22%7D%2C%7B%22x%22%3A300.8874%2C%22y%22%3A137.54883%2C%22width%22%3A56.516899999999964%2C%22height%22%3A21.23514%2C%22text%22%3A%22root%22%7D%2C%7B%22x%22%3A650.32837%2C%22y%22%3A139.13702%2C%22width%22%3A42.22943000000009%2C%22height%22%3A18.491929999999996%2C%22text%22%3A%22etc%22%7D%2C%7B%22x%22%3A523.8746%2C%22y%22%3A167.24144%2C%22width%22%3A28.349640000000022%2C%22height%22%3A22.839139999999986%2C%22text%22%3A%2227%22%7D%2C%7B%22x%22%3A383.795%2C%22y%22%3A167.48236%2C%22width%22%3A105.44889999999998%2C%22height%22%3A23.150029999999987%2C%22text%22%3A%2240966%E6%9C%88%22%7D%2C%7B%22x%22%3A201.88133%2C%22y%22%3A168.33559%2C%22width%22%3A13.671500000000009%2C%22height%22%3A13.671500000000009%2C%22text%22%3A%223%22%7D%2C%7B%22x%22%3A566.3188%2C%22y%22%3A168.11847%2C%22width%22%3A69.97900000000004%2C%22height%22%3A22.705579999999998%2C%22text%22%3A%2217%3A53%22%7D%2C%7B%22x%22%3A650.3197%2C%22y%22%3A168.94994%2C%22width%22%3A56.01660000000004%2C%22height%22%3A20.66738000000001%2C%22text%22%3A%22home%22%7D%2C%7B%22x%22%3A300.60474%2C%22y%22%3A169.18007%2C%22width%22%3A55.78332%2C%22height%22%3A20.18329%2C%22text%22%3A%22root%22%7D%2C%7B%22x%22%3A7.503627%2C%22y%22%3A169.97777%2C%22width%22%3A148.101783%2C%22height%22%3A19.185120000000012%2C%22text%22%3A%22drwxr-xr-x%2C%22%7D%2C%7B%22x%22%3A232.3538%2C%22y%22%3A169.84135%2C%22width%22%3A55.51289999999997%2C%22height%22%3A19.82204999999999%2C%22text%22%3A%22root%22%7D%2C%7B%22x%22%3A425.73587%2C%22y%22%3A199.42073%2C%22width%22%3A64.54111%2C%22height%22%3A23.40097%2C%22text%22%3A%2276%E6%9C%88%22%7D%2C%7B%22x%22%3A747.18604%2C%22y%22%3A199.44711%2C%22width%22%3A100.73631999999998%2C%22height%22%3A23.173540000000003%2C%22text%22%3A%22usr%2F1ib%22%7D%2C%7B%22x%22%3A651.73303%2C%22y%22%3A200.24945%2C%22width%22%3A39.334370000000035%2C%22height%22%3A20.952550000000002%2C%22text%22%3A%22ib%22%7D%2C%7B%22x%22%3A567.476%2C%22y%22%3A199.86452%2C%22width%22%3A69.76319999999998%2C%22height%22%3A22.263080000000002%2C%22text%22%3A%2214%3A43%22%7D%2C%7B%22x%22%3A201.9933%2C%22y%22%3A200.4138%2C%22width%22%3A15.456299999999999%2C%22height%22%3A15.456299999999999%2C%22text%22%3A%22%E4%B8%80r%22%7D%2C%7B%22x%22%3A524.466%2C%22y%22%3A200.41934%2C%22width%22%3A29.543769999999995%2C%22height%22%3A20.609800000000007%2C%22text%22%3A%2219%22%7D%2C%7B%22x%22%3A9.620706%2C%22y%22%3A201.90909%2C%22width%22%3A146.41490399999998%2C%22height%22%3A19.800510000000003%2C%22text%22%3A%22Lrwxrwxrwx.%22%7D%2C%7B%22x%22%3A300.74698%2C%22y%22%3A201.93307%2C%22width%22%3A56.136559999999974%2C%22height%22%3A18.90673000000001%2C%22text%22%3A%22root%22%7D%2C%7B%22x%22%3A231.8306%2C%22y%22%3A202.2475%2C%22width%22%3A56.48147%2C%22height%22%3A18.873289999999997%2C%22text%22%3A%22root%22%7D%2C%7B%22x%22%3A523.61237%2C%22y%22%3A231.67014%2C%22width%22%3A28.36202999999989%2C%22height%22%3A21.304879999999997%2C%22text%22%3A%2219%22%7D%2C%7B%22x%22%3A651.142%2C%22y%22%3A231.95097%2C%22width%22%3A69.67435%2C%22height%22%3A20.600409999999982%2C%22text%22%3A%221ib64%22%7D%2C%7B%22x%22%3A565.8096%2C%22y%22%3A232.22714%2C%22width%22%3A70.54399999999998%2C%22height%22%3A20.130210000000005%2C%22text%22%3A%2214%3A43%22%7D%2C%7B%22x%22%3A424.3244%2C%22y%22%3A232.45656%2C%22width%22%3A65.38059999999996%2C%22height%22%3A22.359110000000015%2C%22text%22%3A%2296%E6%9C%88%22%7D%2C%7B%22x%22%3A774.8381%2C%22y%22%3A231.90974%2C%22width%22%3A129.84255999999993%2C%22height%22%3A22.707960000000014%2C%22text%22%3A%22usr%2Flib64%22%7D%2C%7B%22x%22%3A9.640972%2C%22y%22%3A233.56044%2C%22width%22%3A147.374148%2C%22height%22%3A20.779570000000007%2C%22text%22%3A%221rwxrwxrwx.%22%7D%2C%7B%22x%22%3A231.78085%2C%22y%22%3A233.2641%2C%22width%22%3A55.615020000000015%2C%22height%22%3A20.82058999999998%2C%22text%22%3A%22root%22%7D%2C%7B%22x%22%3A302.4234%2C%22y%22%3A233.84198%2C%22width%22%3A53.745479999999986%2C%22height%22%3A19.10410999999999%2C%22text%22%3A%22root%22%7D%2C%7B%22x%22%3A201.31628%2C%22y%22%3A262.17444%2C%22width%22%3A15.704499999999996%2C%22height%22%3A15.704499999999996%2C%22text%22%3A%222%22%7D%2C%7B%22x%22%3A369.54657%2C%22y%22%3A262.65955%2C%22width%22%3A71.42880000000002%2C%22height%22%3A24.27355%2C%22text%22%3A%2216384%22%7D%2C%7B%22x%22%3A651.43036%2C%22y%22%3A263.07993%2C%22width%22%3A139.76814000000002%2C%22height%22%3A24.110929999999996%2C%22text%22%3A%22lost%2Bfound%22%7D%2C%7B%22x%22%3A524.2056%2C%22y%22%3A263.1876%2C%22width%22%3A29.760599999999954%2C%22height%22%3A22.177880000000016%2C%22text%22%3A%2219%22%7D%2C%7B%22x%22%3A453.7645%2C%22y%22%3A263.52048%2C%22width%22%3A36.29509999999999%2C%22height%22%3A22.80565999999999%2C%22text%22%3A%226%E6%9C%88%22%7D%2C%7B%22x%22%3A565.9478%2C%22y%22%3A264.233%2C%22width%22%3A70.82529999999997%2C%22height%22%3A21.614899999999977%2C%22text%22%3A%2214%3A43%22%7D%2C%7B%22x%22%3A4.392524%2C%22y%22%3A264.52872%2C%22width%22%3A61.615379999999995%2C%22height%22%3A22.80422999999996%2C%22text%22%3A%22drwx%22%7D%2C%7B%22x%22%3A231.26396%2C%22y%22%3A266.49377%2C%22width%22%3A56.50517000000002%2C%22height%22%3A18.869230000000016%2C%22text%22%3A%22root%22%7D%2C%7B%22x%22%3A303.0455%2C%22y%22%3A267.13565%2C%22width%22%3A52.739959999999996%2C%22height%22%3A18.553449999999998%2C%22text%22%3A%22root%22%7D%2C%7B%22x%22%3A566.2641%2C%22y%22%3A295.20987%2C%22width%22%3A140.93024000000003%2C%22height%22%3A23.70360999999997%2C%22text%22%3A%222018media%22%7D%2C%7B%22x%22%3A5.6935506%2C%22y%22%3A295.90085%2C%22width%22%3A150.92900939999998%2C%22height%22%3A22.07325000000003%2C%22text%22%3A%22drwxr-xr-x%2C%22%7D%2C%7B%22x%22%3A452.11487%2C%22y%22%3A296.00156%2C%22width%22%3A37.43738000000002%2C%22height%22%3A22.75726000000003%2C%22text%22%3A%224%E6%9C%88%22%7D%2C%7B%22x%22%3A201.4901%2C%22y%22%3A296.09662%2C%22width%22%3A15.952359999999999%2C%22height%22%3A15.952359999999999%2C%22text%22%3A%222%22%7D%2C%7B%22x%22%3A383.97125%2C%22y%22%3A296.40216%2C%22width%22%3A57.535450000000026%2C%22height%22%3A20.21848%2C%22text%22%3A%224096%22%7D%2C%7B%22x%22%3A523.595%2C%22y%22%3A296.80453%2C%22width%22%3A27.69259999999997%2C%22height%22%3A20.65793000000002%2C%22text%22%3A%2211%22%7D%2C%7B%22x%22%3A232.50073%2C%22y%22%3A298.29874%2C%22width%22%3A54.95824999999999%2C%22height%22%3A19.257900000000006%2C%22text%22%3A%22root%22%7D%2C%7B%22x%22%3A303.03772%2C%22y%22%3A298.7472%2C%22width%22%3A53.17676%2C%22height%22%3A19.292929999999956%2C%22text%22%3A%22root%22%7D%2C%7B%22x%22%3A452.82013%2C%22y%22%3A326.37637%2C%22width%22%3A36.78372000000002%2C%22height%22%3A24.28195999999997%2C%22text%22%3A%224%E6%9C%88%22%7D%2C%7B%22x%22%3A384.2925%2C%22y%22%3A328.221%2C%22width%22%3A56.50819999999999%2C%22height%22%3A19.43900000000002%2C%22text%22%3A%224096%22%7D%2C%7B%22x%22%3A200.55893%2C%22y%22%3A328.37527%2C%22width%22%3A16.225840000000005%2C%22height%22%3A16.225840000000005%2C%22text%22%3A%222%22%7D%2C%7B%22x%22%3A523.6645%2C%22y%22%3A328.52188%2C%22width%22%3A28.12970000000007%2C%22height%22%3A19.756680000000017%2C%22text%22%3A%2211%22%7D%2C%7B%22x%22%3A565.63983%2C%22y%22%3A328.9472%2C%22width%22%3A57.52386999999999%2C%22height%22%3A19.94135%2C%22text%22%3A%222018%22%7D%2C%7B%22x%22%3A633.8311%2C%22y%22%3A329.43826%2C%22width%22%3A46.06734000000006%2C%22height%22%3A21.220979999999997%2C%22text%22%3A%22mnt%22%7D%2C%7B%22x%22%3A5.901381%2C%22y%22%3A329.99603%2C%22width%22%3A150.30161900000002%2C%22height%22%3A20.38290999999998%2C%22text%22%3A%22drwxr-xr-x%2C%22%7D%2C%7B%22x%22%3A302.9263%2C%22y%22%3A330.8118%2C%22width%22%3A54.413599999999974%2C%22height%22%3A18.83359999999999%2C%22text%22%3A%22root%22%7D%2C%7B%22x%22%3A230.9717%2C%22y%22%3A330.90457%2C%22width%22%3A56.90390000000002%2C%22height%22%3A18.080900000000042%2C%22text%22%3A%22root%22%7D%2C%7B%22x%22%3A453.24442%2C%22y%22%3A359.32864%2C%22width%22%3A37.39312000000001%2C%22height%22%3A24.265379999999993%2C%22text%22%3A%226%E6%9C%88%22%7D%2C%7B%22x%22%3A383.8448%2C%22y%22%3A360.00815%2C%22width%22%3A55.92512999999997%2C%22height%22%3A20.833619999999996%2C%22text%22%3A%224096%22%7D%2C%7B%22x%22%3A523.43335%2C%22y%22%3A360.5791%2C%22width%22%3A28.58159999999998%2C%22height%22%3A20.595700000000022%2C%22text%22%3A%2225%22%7D%2C%7B%22x%22%3A201.17647%2C%22y%22%3A360.62418%2C%22width%22%3A16.88255000000001%2C%22height%22%3A16.88255000000001%2C%22text%22%3A%223%22%7D%2C%7B%22x%22%3A567.432%2C%22y%22%3A360.7485%2C%22width%22%3A68.69719999999995%2C%22height%22%3A19.647440000000017%2C%22text%22%3A%2210%3A27%22%7D%2C%7B%22x%22%3A6.332991%2C%22y%22%3A361.46527%2C%22width%22%3A150.291799%2C%22height%22%3A22.905880000000025%2C%22text%22%3A%22drwxr-xr-x%22%7D%2C%7B%22x%22%3A302.7424%2C%22y%22%3A362.03726%2C%22width%22%3A53.76520000000005%2C%22height%22%3A19.577879999999993%2C%22text%22%3A%22root%22%7D%2C%7B%22x%22%3A648.697%2C%22y%22%3A361.10742%2C%22width%22%3A44.280200000000036%2C%22height%22%3A23.232550000000003%2C%22text%22%3A%22opt%22%7D%2C%7B%22x%22%3A232.30638%2C%22y%22%3A362.12512%2C%22width%22%3A54.94530000000003%2C%22height%22%3A19.416600000000017%2C%22text%22%3A%22root%22%7D%2C%7B%22x%22%3A524.3543%2C%22y%22%3A391.95053%2C%22width%22%3A29.585640000000012%2C%22height%22%3A20.538729999999987%2C%22text%22%3A%2225%22%7D%2C%7B%22x%22%3A565.94916%2C%22y%22%3A392.39282%2C%22width%22%3A69.94083999999998%2C%22height%22%3A20.950530000000015%2C%22text%22%3A%2220%3A39%22%7D%2C%7B%22x%22%3A424.64667%2C%22y%22%3A392.24216%2C%22width%22%3A64.27063000000004%2C%22height%22%3A22.520569999999964%2C%22text%22%3A%22%E6%97%A56%E6%9C%88%22%7D%2C%7B%22x%22%3A187.68385%2C%22y%22%3A392.59616%2C%22width%22%3A27.514099999999985%2C%22height%22%3A19.89154000000002%2C%22text%22%3A%2283%22%7D%2C%7B%22x%22%3A303.56848%2C%22y%22%3A392.8025%2C%22width%22%3A53.26639%2C%22height%22%3A21.14855%2C%22text%22%3A%22root%22%7D%2C%7B%22x%22%3A232.99374%2C%22y%22%3A394.66058%2C%22width%22%3A55.07711999999998%2C%22height%22%3A18.68589000000003%2C%22text%22%3A%22root%22%7D%2C%7B%22x%22%3A648.1233%2C%22y%22%3A393.62286%2C%22width%22%3A59.02665999999999%2C%22height%22%3A22.335339999999974%2C%22text%22%3A%22proc%22%7D%2C%7B%22x%22%3A6.4315543%2C%22y%22%3A394.8826%2C%22width%22%3A141.50705570000002%2C%22height%22%3A17.958370000000002%2C%22text%22%3A%22dr-xr-xr-x%22%7D%2C%7B%22x%22%3A384.5809%2C%22y%22%3A423.57254%2C%22width%22%3A55.315%2C%22height%22%3A20.4812%2C%22text%22%3A%224096%22%7D%2C%7B%22x%22%3A523.267%2C%22y%22%3A423.4796%2C%22width%22%3A29.679899999999975%2C%22height%22%3A21.708849999999984%2C%22text%22%3A%2227%22%7D%2C%7B%22x%22%3A568.72906%2C%22y%22%3A424.10913%2C%22width%22%3A66.04844000000003%2C%22height%22%3A20.939570000000003%2C%22text%22%3A%2218%3A27%22%7D%2C%7B%22x%22%3A452.49152%2C%22y%22%3A424.41492%2C%22width%22%3A37.27102000000002%2C%22height%22%3A23.273529999999994%2C%22text%22%3A%226%E6%9C%88%22%7D%2C%7B%22x%22%3A202.42537%2C%22y%22%3A425.67084%2C%22width%22%3A11.732070000000022%2C%22height%22%3A11.732070000000022%2C%22text%22%3A%227%22%7D%2C%7B%22x%22%3A302.224%2C%22y%22%3A425.3838%2C%22width%22%3A54.55720000000002%2C%22height%22%3A20.025350000000003%2C%22text%22%3A%22root%22%7D%2C%7B%22x%22%3A651.17126%2C%22y%22%3A426.64127%2C%22width%22%3A55.385380000000055%2C%22height%22%3A19.84386999999998%2C%22text%22%3A%22root%22%7D%2C%7B%22x%22%3A6.0969753%2C%22y%22%3A427.03418%2C%22width%22%3A148.8235147%2C%22height%22%3A19.246820000000014%2C%22text%22%3A%22dr-xr-x---%2C%22%7D%2C%7B%22x%22%3A232.67393%2C%22y%22%3A427.54932%2C%22width%22%3A55.52721%2C%22height%22%3A17.771079999999984%2C%22text%22%3A%22root%22%7D%2C%7B%22x%22%3A454.6825%2C%22y%22%3A454.33102%2C%22width%22%3A36.66399999999999%2C%22height%22%3A24.999359999999967%2C%22text%22%3A%226%E6%9C%88%22%7D%2C%7B%22x%22%3A397.67914%2C%22y%22%3A455.05945%2C%22width%22%3A42.991240000000005%2C%22height%22%3A22.387209999999982%2C%22text%22%3A%22860%22%7D%2C%7B%22x%22%3A523.6137%2C%22y%22%3A455.86038%2C%22width%22%3A29.116600000000062%2C%22height%22%3A21.234440000000006%2C%22text%22%3A%2226%22%7D%2C%7B%22x%22%3A567.44824%2C%22y%22%3A456.01053%2C%22width%22%3A69.56525999999997%2C%22height%22%3A21.090329999999994%2C%22text%22%3A%2210%3A42%22%7D%2C%7B%22x%22%3A188.56233%2C%22y%22%3A456.35745%2C%22width%22%3A27.19614999999999%2C%22height%22%3A20.580290000000048%2C%22text%22%3A%2228%22%7D%2C%7B%22x%22%3A7.222349%2C%22y%22%3A458.1784%2C%22width%22%3A140.831271%2C%22height%22%3A18.91525999999999%2C%22text%22%3A%22drwxr-xr-x%22%7D%2C%7B%22x%22%3A233.24673%2C%22y%22%3A458.5147%2C%22width%22%3A54.98089999999996%2C%22height%22%3A18.660649999999976%2C%22text%22%3A%22root%22%7D%2C%7B%22x%22%3A302.6919%2C%22y%22%3A458.76898%2C%22width%22%3A55.57806000000005%2C%22height%22%3A19.879369999999994%2C%22text%22%3A%22root%22%7D%2C%7B%22x%22%3A650.9432%2C%22y%22%3A459.63446%2C%22width%22%3A40.89029999999991%2C%22height%22%3A18.220280000000002%2C%22text%22%3A%22run%22%7D%2C%7B%22x%22%3A523.9283%2C%22y%22%3A487.86227%2C%22width%22%3A28.660499999999956%2C%22height%22%3A21.372169999999983%2C%22text%22%3A%2219%22%7D%2C%7B%22x%22%3A648.4101%2C%22y%22%3A488.00525%2C%22width%22%3A228.26555999999994%2C%22height%22%3A23.328700000000026%2C%22text%22%3A%22sbin-%3Eusr%2Fsbin%22%7D%2C%7B%22x%22%3A566.73584%2C%22y%22%3A488.29993%2C%22width%22%3A68.97411999999997%2C%22height%22%3A20.52179000000001%2C%22text%22%3A%2214%3A43%22%7D%2C%7B%22x%22%3A428.34283%2C%22y%22%3A488.01038%2C%22width%22%3A56.022040000000004%2C%22height%22%3A23.296350000000018%2C%22text%22%3A%2286%E6%9C%88%22%7D%2C%7B%22x%22%3A9.024564%2C%22y%22%3A489.8856%2C%22width%22%3A146.588796%2C%22height%22%3A20.912699999999973%2C%22text%22%3A%221rwxrwxrwx.%22%7D%2C%7B%22x%22%3A201.20003%2C%22y%22%3A490.1182%2C%22width%22%3A16.761660000000006%2C%22height%22%3A16.761660000000006%2C%22text%22%3A%221%22%7D%2C%7B%22x%22%3A231.92206%2C%22y%22%3A489.68512%2C%22width%22%3A56.610990000000015%2C%22height%22%3A20.229640000000018%2C%22text%22%3A%22root%22%7D%2C%7B%22x%22%3A301.80435%2C%22y%22%3A490.16333%2C%22width%22%3A54.42824999999999%2C%22height%22%3A19.918210000000045%2C%22text%22%3A%22root%22%7D%2C%7B%22x%22%3A454.73947%2C%22y%22%3A519.8883%2C%22width%22%3A34.29248000000001%2C%22height%22%3A22.15050000000008%2C%22text%22%3A%224%E6%9C%88%22%7D%2C%7B%22x%22%3A566.23444%2C%22y%22%3A520.01373%2C%22width%22%3A112.95886000000007%2C%22height%22%3A21.693769999999972%2C%22text%22%3A%222018sry%22%7D%2C%7B%22x%22%3A523.7115%2C%22y%22%3A520.3974%2C%22width%22%3A29.707199999999943%2C%22height%22%3A20.728800000000092%2C%22text%22%3A%2211%22%7D%2C%7B%22x%22%3A197.74005%2C%22y%22%3A520.5744%2C%22width%22%3A19.717929999999996%2C%22height%22%3A19.717929999999996%2C%22text%22%3A%222%22%7D%2C%7B%22x%22%3A384.78595%2C%22y%22%3A520.8593%2C%22width%22%3A54.78481999999997%2C%22height%22%3A18.987439999999992%2C%22text%22%3A%224096%22%7D%2C%7B%22x%22%3A232.57744%2C%22y%22%3A521.6865%2C%22width%22%3A55.622390000000024%2C%22height%22%3A19.350849999999923%2C%22text%22%3A%22root%22%7D%2C%7B%22x%22%3A6.463346%2C%22y%22%3A522.5369%2C%22width%22%3A149.403214%2C%22height%22%3A19.471900000000005%2C%22text%22%3A%22drwxr-xr-x%22%7D%2C%7B%22x%22%3A301.24905%2C%22y%22%3A521.9705%2C%22width%22%3A55.35500999999999%2C%22height%22%3A19.36824999999999%2C%22text%22%3A%22root%22%7D%2C%7B%22x%22%3A566.30615%2C%22y%22%3A551.7539%2C%22width%22%3A70.33979%2C%22height%22%3A21.47375999999997%2C%22text%22%3A%2204%3A39%22%7D%2C%7B%22x%22%3A187.33092%2C%22y%22%3A552.45996%2C%22width%22%3A29.433220000000006%2C%22height%22%3A21.893680000000018%2C%22text%22%3A%2213%22%7D%2C%7B%22x%22%3A426.6733%2C%22y%22%3A552.63684%2C%22width%22%3A63.097669999999994%2C%22height%22%3A21.825500000000034%2C%22text%22%3A%22%E6%97%A56%E6%9C%88%22%7D%2C%7B%22x%22%3A522.86975%2C%22y%22%3A552.88074%2C%22width%22%3A29.981390000000033%2C%22height%22%3A20.31636000000003%2C%22text%22%3A%2226%22%7D%2C%7B%22x%22%3A5.344243%2C%22y%22%3A553.7174%2C%22width%22%3A143.250787%2C%22height%22%3A21.843899999999962%2C%22text%22%3A%22dr-xr-xr-x%22%7D%2C%7B%22x%22%3A300.87094%2C%22y%22%3A553.8529%2C%22width%22%3A55.74377999999996%2C%22height%22%3A18.947700000000054%2C%22text%22%3A%22root%22%7D%2C%7B%22x%22%3A231.66203%2C%22y%22%3A554.87494%2C%22width%22%3A57.21351999999999%2C%22height%22%3A18.682309999999916%2C%22text%22%3A%22root%22%7D%2C%7B%22x%22%3A650.46906%2C%22y%22%3A555.6456%2C%22width%22%3A42.16179999999997%2C%22height%22%3A19.760500000000093%2C%22text%22%3A%22sys%22%7D%2C%7B%22x%22%3A522.5558%2C%22y%22%3A583.4494%2C%22width%22%3A30.043000000000006%2C%22height%22%3A22.451540000000023%2C%22text%22%3A%2227%22%7D%2C%7B%22x%22%3A383.7857%2C%22y%22%3A584.0705%2C%22width%22%3A57.362499999999955%2C%22height%22%3A21.053769999999986%2C%22text%22%3A%224096%22%7D%2C%7B%22x%22%3A453.16342%2C%22y%22%3A584.254%2C%22width%22%3A37.54782%2C%22height%22%3A22.27126999999996%2C%22text%22%3A%226%E6%9C%88%22%7D%2C%7B%22x%22%3A7.1029577%2C%22y%22%3A584.5007%2C%22width%22%3A150.5996623%2C%22height%22%3A21.457859999999982%2C%22text%22%3A%22drwxnwxrwt.%22%7D%2C%7B%22x%22%3A566.71375%2C%22y%22%3A584.8012%2C%22width%22%3A69.03228000000001%2C%22height%22%3A19.542730000000006%2C%22text%22%3A%2218%3A35%22%7D%2C%7B%22x%22%3A187.7042%2C%22y%22%3A585.1644%2C%22width%22%3A28.132000000000005%2C%22height%22%3A20.03134%2C%22text%22%3A%2210%22%7D%2C%7B%22x%22%3A650.501%2C%22y%22%3A586.6796%2C%22width%22%3A41.42790000000002%2C%22height%22%3A21.02819999999997%2C%22text%22%3A%22tmp%22%7D%2C%7B%22x%22%3A232.19221%2C%22y%22%3A585.72394%2C%22width%22%3A55.857169999999996%2C%22height%22%3A20.427459999999996%2C%22text%22%3A%22root%22%7D%2C%7B%22x%22%3A301.72708%2C%22y%22%3A586.07074%2C%22width%22%3A55.28782000000001%2C%22height%22%3A19.87886000000003%2C%22text%22%3A%22root%22%7D%2C%7B%22x%22%3A523.9297%2C%22y%22%3A614.9038%2C%22width%22%3A29.27355%2C%22height%22%3A22.396999999999935%2C%22text%22%3A%2219%22%7D%2C%7B%22x%22%3A453.74765%2C%22y%22%3A615.3014%2C%22width%22%3A37.48449999999997%2C%22height%22%3A23.26010000000008%2C%22text%22%3A%226%E6%9C%88%22%7D%2C%7B%22x%22%3A384.2932%2C%22y%22%3A616.53064%2C%22width%22%3A57.17829999999998%2C%22height%22%3A19.55616000000009%2C%22text%22%3A%224096%22%7D%2C%7B%22x%22%3A188.32008%2C%22y%22%3A617.0484%2C%22width%22%3A27.489400000000018%2C%22height%22%3A19.855159999999955%2C%22text%22%3A%2213%22%7D%2C%7B%22x%22%3A565.55493%2C%22y%22%3A617.3198%2C%22width%22%3A70.34887000000003%2C%22height%22%3A19.287199999999984%2C%22text%22%3A%2214%3A43%22%7D%2C%7B%22x%22%3A231.5577%2C%22y%22%3A617.9055%2C%22width%22%3A56.30246999999997%2C%22height%22%3A20.65370000000007%2C%22text%22%3A%22root%22%7D%2C%7B%22x%22%3A300.67615%2C%22y%22%3A617.2804%2C%22width%22%3A56.736549999999966%2C%22height%22%3A20.86590000000001%2C%22text%22%3A%22root%22%7D%2C%7B%22x%22%3A5.3435555%2C%22y%22%3A618.31805%2C%22width%22%3A151.3741145%2C%22height%22%3A18.643350000000055%2C%22text%22%3A%22drwxr-xr-x%2C%22%7D%2C%7B%22x%22%3A649.87695%2C%22y%22%3A619.905%2C%22width%22%3A42.35545000000002%2C%22height%22%3A17.844900000000052%2C%22text%22%3A%22usr%22%7D%2C%7B%22x%22%3A383.62155%2C%22y%22%3A647.27423%2C%22width%22%3A57.86484999999999%2C%22height%22%3A21.538999999999987%2C%22text%22%3A%224096%22%7D%2C%7B%22x%22%3A523.9892%2C%22y%22%3A648.1214%2C%22width%22%3A27.675960000000032%2C%22height%22%3A20.926600000000008%2C%22text%22%3A%2219%22%7D%2C%7B%22x%22%3A567.31213%2C%22y%22%3A648.6637%2C%22width%22%3A69.30102999999997%2C%22height%22%3A21.48040000000003%2C%22text%22%3A%2206%3A46%22%7D%2C%7B%22x%22%3A187.74356%2C%22y%22%3A648.82837%2C%22width%22%3A29.32274000000001%2C%22height%22%3A20.573180000000093%2C%22text%22%3A%2219%22%7D%2C%7B%22x%22%3A452.50107%2C%22y%22%3A648.2879%2C%22width%22%3A41.79015999999996%2C%22height%22%3A24.42579999999998%2C%22text%22%3A%226%E6%9C%88%22%7D%2C%7B%22x%22%3A6.791746%2C%22y%22%3A649.382%2C%22width%22%3A149.98620400000001%2C%22height%22%3A20.242150000000038%2C%22text%22%3A%22drwxr-xr-x%2C%22%7D%2C%7B%22x%22%3A231.56946%2C%22y%22%3A649.7911%2C%22width%22%3A55.91140999999999%2C%22height%22%3A19.69380000000001%2C%22text%22%3A%22root%22%7D%2C%7B%22x%22%3A301.4149%2C%22y%22%3A649.7656%2C%22width%22%3A54.520039999999995%2C%22height%22%3A19.885200000000054%2C%22text%22%3A%22root%22%7D%2C%7B%22x%22%3A649.7088%2C%22y%22%3A650.6464%2C%22width%22%3A42.670600000000036%2C%22height%22%3A19.197000000000003%2C%22text%22%3A%22var%22%7D%2C%7B%22x%22%3A478.64478%2C%22y%22%3A669.54205%2C%22width%22%3A20.391750000000002%2C%22height%22%3A15.660549999999944%2C%22text%22%3A%22H%22%7D%5D%2C%22style%22%3A%22none%22%2C%22search%22%3A%22%E6%80%BB%E7%94%A8%E9%87%8F60%2014%3A43bin-%3Eur%2Fbin%2019%2076%E6%9C%88%20root%20Lrwxrwxrwx.%20root%204096%206%E6%9C%88%20boot%2014%3A52%2019%205%20root%20dr-xr-xr-x.%20root%206%E6%9C%88%202960%2025%2020%3A39dev%20drwxr-xr-x%2019%20root%20root%2026%206%E6%9C%88%2010%3A41%204096%20drwxr-xr-x.101%20root%20root%20etc%2027%2040966%E6%9C%88%203%2017%3A53%20home%20root%20drwxr-xr-x%2C%20root%2076%E6%9C%88%20usr%2F1ib%20ib%2014%3A43%20%E4%B8%80r%2019%20Lrwxrwxrwx.%20root%20root%2019%201ib64%2014%3A43%2096%E6%9C%88%20usr%2Flib64%201rwxrwxrwx.%20root%20root%202%2016384%20lost%2Bfound%2019%206%E6%9C%88%2014%3A43%20drwx%20root%20root%202018media%20drwxr-xr-x%2C%204%E6%9C%88%202%204096%2011%20root%20root%204%E6%9C%88%204096%202%2011%202018%20mnt%20drwxr-xr-x%2C%20root%20root%206%E6%9C%88%204096%2025%203%2010%3A27%20drwxr-xr-x%20root%20opt%20root%2025%2020%3A39%20%E6%97%A56%E6%9C%88%2083%20root%20root%20proc%20dr-xr-xr-x%204096%2027%2018%3A27%206%E6%9C%88%207%20root%20root%20dr-xr-x---%2C%20root%206%E6%9C%88%20860%2026%2010%3A42%2028%20drwxr-xr-x%20root%20root%20run%2019%20sbin-%3Eusr%2Fsbin%2014%3A43%2086%E6%9C%88%201rwxrwxrwx.%201%20root%20root%204%E6%9C%88%202018sry%2011%202%204096%20root%20drwxr-xr-x%20root%2004%3A39%2013%20%E6%97%A56%E6%9C%88%2026%20dr-xr-xr-x%20root%20root%20sys%2027%204096%206%E6%9C%88%20drwxnwxrwt.%2018%3A35%2010%20tmp%20root%20root%2019%206%E6%9C%88%204096%2013%2014%3A43%20root%20root%20drwxr-xr-x%2C%20usr%204096%2019%2006%3A46%2019%206%E6%9C%88%20drwxr-xr-x%2C%20root%20root%20var%20H%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%2C%22width%22%3A503%2C%22height%22%3A347%7D"></card></p><p data-lake-id="4a17955dbef28527e88ff9345dda4b9e" style="text-align: left;">/root:：root最高权限用户的home目录</p><p data-lake-id="8d34ae164d543ca7bc0cd44f7391d74c" style="text-align: left;">/bin：用户二进制可执行文件目录。里面存放的都是用户可执行的命令文件</p><p data-lake-id="1896c63e7f48bc7bed71590f7964c51b" style="text-align: left;">/dev：设备文件 设备文件分两种类型 块设备和字符设备。例如插入U盘系统会自动在设备文件下创建设备文件</p><p data-lake-id="e9568758df85c34a3d22259f58d0cbd3" style="text-align: left;">/home：用户的home目录，每个用户都有home目录 默认格式/home/username，在传统的Unix系统没有home目录，因为root用户的home目录就是root 不需要登录</p><p data-lake-id="a8aaca2b16b06061bc64c347366e6a63" style="text-align: left;">/lib：库文件。库文件分为两种</p><p data-lake-id="49985c4fa1c3de7bb5bda49760ae0de4" style="text-indent: 28px; text-align: left;">动态库：xxx.so(share Object)共享对象。库就是被封装好的应用程序，但没有程序入口不具备自我启动能力称为库。当程序被载入内存使用需要用到相应的库文件将之载入内存使用。如果多个程序调用同一库文件内存中只加载一份</p><p data-lake-id="3414ae491df145998ac5c14d1097672a" style="text-indent: 28px; text-align: left;">静态库：xxx.a  直接链接到程序的地址空间中，作为程序的一部分而运行。静态库有利于程序的移植和单独管理。</p><p data-lake-id="99b9300f7dfdabfbbeec3d476f4458d3" style="text-indent: 28px; text-align: left;">当程序需要从一台主机移植到另一台机，如果采用静态方式编编译只需将程序移植过去即可使用而动态库则需要移植与之对应的动态库文件</p><p data-lake-id="ae867a21385e3dae73814b51c9642654" style="text-align: left;">/media：挂载点目录，当系统接受外来设备例如光盘插入光驱之后Linux必须要将当前设备文件系统中的设备与挂载目录与之关联才能进行访问。而挂载就是将当前设备文件系统的某一个目录与挂载目录建立关联关系称之为挂载过程</p><p data-lake-id="7fe0f40803fc4b5f8a5857a7a85432ee" style="text-align: left;">/opt：option 可选目录。用于安装第三方程序。现在的约定都放在usr目录</p><p data-lake-id="6eb4719048c54a47206380571bfffe98" style="text-align: left;">/selinux：</p><p data-lake-id="0d5b8d31ff7898f5b8c09dc93fb950ed" style="text-align: left;">/sys：硬件设备属性映像文件目录，系统关机里面都是空的。内核的调优都在此目录文件下修改。例如磁盘IO调度队列参数都可以在此目录下修改</p><p data-lake-id="646f96b4a328e82e22513fc17a5f8787" style="text-align: left;">/usr：只读文件目录</p><p data-lake-id="29e8d74334eb22d77f15188f8a6ccce0" style="text-align: left;">/boot：系统启动相关的文件。如内核、initrd启动连接文件、grub分区启动文件</p><p data-lake-id="ae1272b12b32b7a6f8edd074a583420e" style="text-align: left;">/etc：配置文件 例如权限系统的配置文件都在里面。里面都是纯文本格式</p><p data-lake-id="6025989f60524392e326fd1e762bc959" style="text-align: left;">/lost+found：任何一个新建的分区都会有的目录。通常在系统断电等等外力因素系统没来得及及时输入输出未保护的数据所提供的备份丢失找回</p><p data-lake-id="24c13e1d63e47f64c3715cf1a21875a3" style="text-align: left;">/mnt：挂载点临时文件目录。作用相同于/media。唯一的区别在于FHS规定/media用于移动设备的挂载。/mnt用于临时文件的挂载。</p><p data-lake-id="e6646ee9ac8546bf1d25d3a7f001e994" style="text-align: left;">/proc：内核映像文件目录，系统关机里面都是空的。内核的工作，可调参数的统计数据。此目录下的文件都是虚拟出来的。无法实现内核的调优参数修改</p><p data-lake-id="f3faebab06304a601126ed8725a640ca" style="text-align: left;">/sbin：管理执行二进制文件。作用同/bin </p><p data-lake-id="69225a968299a269d9b048e01f48bac1" style="text-align: left;">/srv：</p><p data-lake-id="dada7a6edeff23b7d9bdf38f78e9e244" style="text-align: left;">/tmp：公共的临时文件目录。任何用户都有权限操作</p><p data-lake-id="7fba95f892f4de95c6e1e1db51d3b91a" style="text-align: left;">/var：变化的文件目录</p><p data-lake-id="607fcd18e9d0987354c052261306df83" style="text-align: left;"><br /></p>',
        iIzMV3: '<!doctype lake><meta name="doc-version" content="1" /><meta name="viewport" content="fixed" /><meta name="typography" content="classic" /><p data-lake-id="a20d224c568e48b9d67847a2c66a8c01_p_0" style="text-align: left;">PC机(OS Linux)启动流程大多都差不多首先回顾一下，当按下电源开关时，电源就开始向主板和其它设备供电，此时电压还不稳定，主板控制芯片组会向CPU发出并保持一个RESET(重置)信号，让CPU初始化。当电源开始稳定供电后芯片组便撤去RESET信号，CPU马上就从地址FFFF0H处开始执行指令，这个地址在系统BIOS的地址范围内，无论是Award BIOS还是AMI BIOS，放在这里的只是一条跳转指令，跳到系统BIOS中真正的启动代码处。 </p><p data-lake-id="2c604b262eab71b5d92f65b240416875" style="text-align: left;"><strong>启动流程(这是一个接力过程)</strong></p><p data-lake-id="78339ecb4734154fc6c5b81213f0a0b7" style="text-indent: 28px; text-align: left;">系统BIOS的启动代码首先要做的事情就是进行POST(Power On Self Test，加电自检)，我们都知道CPU自己本身什么事情都不会做，就是执行预先编排好的cpu指令，而指令需要从内存中取。当系统刚开机的那一刻内存中什么都没有，所以这个时候系统必须要完成自己的过程这就意味着必须要有硬件完成固化指令，所以在硬件设计的最初在开机的时候由cpu指挥将某个特定的设备下的内容装载进内存，而这个过程会将系统所用到的指令程序映射进CPU可以查找到的物理地址空间中。</p><p data-lake-id="4ac4bfc2750d0c3f17413946b0c7de6a" style="text-indent: 28px; text-align: left;">根据固化指令中定义的信息设置了BIOS(boot sequece)启动次序设定外部的IO设备或者存储设备自上而下寻找MBR。MBR中446字节的bootloader。bootloader很关键它会根据MBR中的分区表查找活动分区，也就意味着找到操作系统所在的分区并加载分区中的内核(当bootloader找到MBR只要读取了MBR如果该MBR损坏无法正常启动bootloader不会寻找第二个设备)。当bootloader获得控制权后就会加载用户选定的磁盘分区中的内核，内核一般都是压缩存放，此时装载内核至内存在内存中完成解压缩功能而后将控制权交给内核。此时内核获得整个系统的控制权内核需要探测每个硬件；操作系统最重要的组件(文件系统，进程管理，内存管理，安全模式，驱动程序，网络管理)，而此时内核只需要探测内存管理、进程管理、文件系统、驱动程序并让其正常工作。当内核获取到所有控制权此时会尝试启动用户管理进程即所谓执行sbin/init二进制执行文件。init执行文件是用户进程空间主导程序，所有用户空间启动的进程都由init负责管理除非用户需要和内核打交道才会切换至内核空间。此时整个系统启动流程至此结束</p><p data-lake-id="3eeb29cddd782f13619a66ab866359f6" style="text-align: left;"><strong>运行级别</strong></p><p data-lake-id="6d9f86e7e1bf2cb763da9f8807d7eae3" style="text-indent: 28px; text-align: left;">LInux中对于系统的安全模式表现形式为系统的运行级别，运行级别就是系统服务运行的级别，由0-6个级别组成。</p><p data-lake-id="0c9bec7d220541e6cfb986c26eb3629d" style="text-align: left;">0：halt，关机</p><p data-lake-id="d1c9f04945e0cde08a8ebea48bf1c2f8" style="text-align: left;">1：single user model，直接以管理员身份切入</p><p data-lake-id="438da23a77952daba68e155392c0f0d4" style="text-align: left;">2：multi user model，NO NFS网络文件系统(默认不启用NFS；当系统默认挂在NFS而NFS启动不了系统就挂了)</p><p data-lake-id="4fb3952c74bcfd949c9babcbd28824e1" style="text-align: left;">3：multi user model，text model 只有命令行不启动图形界面</p><p data-lake-id="34312197d20027a0c39dc67800e3b95c" style="text-align: left;">4：reserved ，默认级别</p><p data-lake-id="1034720000d992ada64343931286ad60" style="text-align: left;">5：multi user model，graphic model 图形模式</p><p data-lake-id="d5947968cdc6e6f1a4c8b79bc87297d8" style="text-align: left;">6：reboot，重启</p><p data-lake-id="83928cfe4b9d1a0f97397467e271ac75" style="text-align: left;"><strong>内核设计</strong></p><p data-lake-id="0aa7a44ea611a8adecb616bb83e2063f" style="text-indent: 28px; text-align: left;">在linux上内核有着独特的设计结构。linux有两种内核结构。</p><p data-lake-id="13b7c29cf434cccedb427205756cad27" style="text-indent: 28px; text-align: left;">单内核：将所有功能都做进内核，内核靠一个进程来完成所有功能</p><p data-lake-id="fea6d081d427681ef8ea7de9ef71b3c6" style="text-indent: 28px; text-align: left;">微内核：将各种外围设备都做成子系统，当需要哪个子系统由内核来调度子系统。</p><p data-lake-id="3c09cf041ac617e1be3d776ea97d3fb6" style="text-indent: 28px; text-align: left;">由于微内核依赖各个子系统导致微内核之间的调度非常复杂。就理论上来讲微内核具有先天的设计优势但由于设计过程过于复杂导致失去了其本身具有的优势，事实上相对于微内核相比单内核优势并不是特别明显。而现在单内核充分采取了微内核的设计思想并且避免了微内核的复杂的调度设计，就目前来讲大多数Linux都属于单内核而Windows、Solaris属于微内核。对于微内核来讲是具有真正意义上的多线程，而对于单内核多线程只是轻量级进程，既然linux属于单内核所有功能都压进内核而内核要识别市面上各种各样的设备驱动就意味着linux内核的大小将会非常非常大，事实上Linux内核为了尽可能支持更多平台内置了20多种架构，代码现在有数千万行解压以后所有文件有几百MB大小。例如Linux为了支持手机端平台提供了Android的ARM架构，IPhone的power-pc架构，嵌入式架构等等等等。而真正用户使用的可能只有一种，这就意味着庞大的内核有绝大多数部分是使用不上的由此只需要选择一种架构进行内核编译再进行一压缩只有1-2M大小，而对于发行版Linux来讲编译好的内核用户无法选定某一种特定的架构就是说这么一来Linux发行版商不得不兼容不同用户的不同硬件设备如果将所有设备都做进内核依然无法避免内核庞大的现状。因此Linux内核采用模块化设计，由核心模块(kerner object)和外围模块组成。核心模块很小可以完成外围模块的动态加载，核心模块通过探测硬件可以获取外围设备的属性如名称、型号找到所需的程序然后到某个路径下将该程序装载进内存进行驱动。系统可以有多个内核，内核的外围设备文件一般的在 /lib/modules/下有一个以内核版本为目录的文件夹，内核自身在boot/下以vmlinuz版本号为文件名的文件目录</p>',
        eMfABz: '<!doctype lake><meta name="doc-version" content="1" /><meta name="viewport" content="fixed" /><meta name="typography" content="classic" /><p data-lake-id="a20d224c568e48b9d67847a2c66a8c01_p_0" style="text-indent: 28px; text-align: left;">前一章讲到Linux加入GUN组织无数优秀程序员纷纷贡献自己的力量，使得Linux短短几年时间从0.1-1.0版的公开发行。但无论是GUN的软件还是Linux的内核都是源代码，源代码是C语言写的程序。任何语言所开发的程序应用想要运行起来必须要经过编译成二进制执行文件。当时源代码的编译无法跨平台也就是说A主机CPU编译的必须要运行在A主机CPU。因为CPU所支持的二进制文件各不相同而Linux对外发布的都是源代码所以使用Linux内核必须要先编译源代码。这时候就出现第三方组织专业进行编译Linux内核和各种依赖程序打包成可安装的二进制Linux程序</p><p data-lake-id="bbe4c54266959e8307ca9a65a950f0d8" style="text-indent: 28px; text-align: left;">其中就包括93年Bob young成立在美国北卡莱罗纳州ReadHat、美国普渡大学默多克的Debian、 德国的一个研究人员研发的SUSE软件发行商等等。</p><p data-lake-id="4ee98c796dc778a081063ad22f8b8b1e" style="text-indent: 28px; text-align: left;">但此时发行的软件各种应用程序打包在一起不利于单个软件的管理。Debina首先研发出在整个系统上单个管理软件的管理器dpt，ReadHat模拟dpt研发出了rpm。但是由于Linux内核遵循GPL协议。根据GPL协议这些厂商包装源代码成二进制文件无论改动扩展什么都必须遵循GPL协议无偿开源。因为GPL协议本身的特性这些各大厂商研发出新的系统应用程序都无法避开GPL协议于是这些厂商开始售卖软件服务，即软件源代码、包装后的二进制可以开源，但出现漏洞后的补丁不免费。这样一来就有一些社区组织诞生，比如Centos(社区企业操作系统)负责ReadHat升级补丁已经重新包装源代码和ReadHat一模一样且完全开源和免费。</p><p data-lake-id="c62dfa5350e2b5b751b3028ff10c98d5" style="text-indent: 28px; text-align: left;">简单来说Centos是基于ReadHat二次发行，Ubuntu是基于Debian的二次发型。ReadHat，SUSE都有自己的商业公司而Debian完全由社区维护。其中Debian技术最先进也最难用获取的垃圾文件很少。现今ReadHat，CentOs在北美州，亚洲非常流行，SUSE在欧洲非常流行。</p><p data-lake-id="e018b991d9097263848c85e2a9eb6d9e" style="text-indent: 28px; text-align: left;">Linux内核现在已经到5.0版<span style="color: #393939;"> </span><a href="https://www.kernel.org/" target="_blank"><u>https://www.kernel.org/</u></a><span style="color: #393939;"> ,Centos 7.0 </span><a href="https://www.linux.org/" target="_blank"><u>https://www.linux.org/</u></a></p><p data-lake-id="6a9c58a3bcbd0d265b85050165b29d33" style="text-indent: 28px; text-align: left;"><span style="color: #393939;">Linux发行时间线非常错综复杂无法详举。可在网上搜寻GNU/Linux Distribution Timeline</span></p>',
        B3mMje: '<!doctype lake><meta name="doc-version" content="1" /><meta name="viewport" content="fixed" /><meta name="typography" content="classic" /><p data-lake-id="a20d224c568e48b9d67847a2c66a8c01_p_0" style="text-indent: 28px; text-align: left;">说起linux不得不先从unix说起。unix不仅仅是操作系统现今而言它更多的代表的是一个范畴不再是某一个特定的操作系统</p><p data-lake-id="2067e1b9d17fdba75e235fb10047045f" style="text-align: left;">它底下有很多各厂商的unix</p><p data-lake-id="c51977830947a715f642d8d009c16c55" style="text-align: left;">例如惠普的 HP-UX，SUN公司的Solaris等等等等</p><p data-lake-id="2225d65da6416e2d5a046a668820f249" style="text-align: left;">在unix操作系统出现之前计算机还没有一个智能具备一个完整意义的操作系统</p><p data-lake-id="8f121f3eeb95de4f6721618a9ac702dd" style="text-align: left;">那时候只有简单的批处理系统</p><p data-lake-id="7fb348eae0669142d6fef9c4efe8d61c" style="text-align: left;">批处理系统:每一个程序直接在计算机运行，由一个个作业完成彼此之间相互依赖，作业1处理完接着载入作业2之间通过分割符连接。这种系统远远无法发挥计算机硬件的功能</p><p data-lake-id="449e6653e21e81b545854987e84fb7da" style="text-align: left;">就在这个时候由</p><p data-lake-id="05b889aa013905a9369499eff708bb11" style="text-align: left;">通用电器、美国的电报电话公司的贝尔实验室以及麻省理工大学的人工智能实验室MIT联合组织使用汇编语言研发多任务多用户的系统Multics。由于违背了初衷(违背什么初衷我也不知道，别问我)</p><p data-lake-id="01d9359040ed63279abfa1a7ed2a1866" style="text-align: left;">GE，MIT相继退出只留下Beil实验室，说到这里不得不说Muiltca系统其实还算很成功。美国福特汽车公司直到2000年才下线Muiltcs系统。当三家组织分裂贝尔实验室许多科学家被闲置起来。有一个叫ken的人在业余时间研发出一套Space Trval图形界面星空大战小游戏。在批处理时代这无疑是非常大的创新，由于贝尔实验室的退出ken无法再使用Muiltcs系统。ken回到贝尔实验室向领导申请一PDP主机。当时PDP主机大概几十万美元一台价格非常昂贵。</p><p data-lake-id="af61402f86c21685cf1e392494e2e4c2" style="text-align: left;">这里不得不说下PDP主机的公司DEC</p><p data-lake-id="87765955aaf97f8a6527eb606f9493b8" style="text-align: left;">当时DEC公司主要生产小型机 中型机。小型机里面有两个比较受欢迎</p><p data-lake-id="bc71e593668e014fa95eabb684ce4497" style="text-align: left;">一个是PDP系列一个是VAX系列</p><p data-lake-id="35cba2863485525088dd29f06b481a52" style="text-align: left;">ken申请PDP11主机失败有一天在实验室角落发现一个破败的PDP7主机。于是ken拿着破败的PDP开始研究自己的Space Trval游戏。Space Trval是一个应用程序，应用程序想要运行必须需要内核操作的系统的完成。就在这时Unix诞生</p><p data-lake-id="ce330d20e2d81bd966406389299cad12" style="text-indent: 28px; text-align: left;">此时Unix使用起来极其不方便，每一主机移植一套Unix系统极其不方便。为了扭转劣势ken和他的一位同事重写了B语言引入了指针等额外的功能(C语言就在两位年轻人手下诞生)</p><p data-lake-id="adc2132864f0b6891945f63ad9e4b173" style="text-align: left;">大概1972年丹尼斯和ken在美国计算机杂志公开发表unix系统论文被各大公司、学校青睐。由于当时种种原因(美国反垄断法)unix系统被迫无奈无偿捐献给各个机构。在美国伯克利大学有一位比尔的研究生成立BSRG小组主要负责改进研发unix系统。BSRG小组对unxi系统进行改进以及引入一些tcp网络等功能发布了一套全新的系统叫BSD</p><p data-lake-id="8d21102a2c02cd2e1f8360f7023c73a5" style="text-align: left;">BSD系统发行后，贝尔实验室被收购。不在受美国法律限制Unix开始商业化授权。一套授权将近4万美元。于是Unix收购商眼红BSD发行商业化赚的盆满钵满与BSD打了十年旷日持久的官司。此时微软正在悄然成长(微软早期的操作系统是纯dos基于当时大多pc机厂商的操作系统CPM改造，后来的图形界面是巧夺乔布斯的)BSRG小组此时已经解散，后来比尔成立大名鼎鼎的SUN公司又对unix系统进行改写发行Solaris。SUN公司为计算机科学发展贡献了许多优秀的产品其中包括非常著名的JAVA，CSH脚本语言后面的章节会提到脚本等等。遗憾的是10年SUN公司被orcale收购，可惜。</p><p data-lake-id="32f148a670bf1ed7252aba2ca907d658" style="text-indent: 28px; text-align: left;">当Unix商业化授权之后很多高校科研机构无法继续使用Unxi系统。这其中包括荷兰一位大学教授安德鲁。此前安德鲁一直在使用unix教学。于是安德鲁决定仿照unix开发一套新的系统Minix诞生。安德鲁带着自己的Minix系统在欧洲各处教学。Minix系统是在安德鲁教授自己主机上开发的，如果其他人想用Minix系统即使同样的硬件也需要自己手动开发驱动用起来极其不方便。当时有他的学生有很多牛人写了很多驱动希望能将这些驱动加进去Minix系统而安德鲁教授不允许任何人来玷污自己的程序。这其中包括赫尔辛基大学的学生Linus他将Minix系统改进重写并套上了一层外壳Linux横空出世。</p><p data-lake-id="d0bd80a20cf803b0e1249ca11a696f4a" style="text-indent: 28px; text-align: left;">Linux能有今天的发展很大程度上取决于GNU组织。GNU发起著名的开源协议规范GLP。倡导软件不应该商业化应该共享开源。而Linux在这个契机加入GNU组织，二者一相遇可谓惊天地、泣鬼神，天昏地暗，日月无光，电闪雷鸣...于是无数全球顶尖人才纷纷加入贡献自己的力量使得Linux迅速壮大到今天依然大行其道。</p>',


      }
    };
  },
  created() {
    this.docInfo = JSON.parse('{"code":10000,"result":[{"group_id":1052,"label":"2.0-Linux bash脚本特性-分组","url":"Vziiuq","children":[{"doc_id":1041,"label":"2.0-Linux bash脚本特性-文章","url":"qeaEre","DocHref":"/test/Vziiuq/qeaEre"},{"group_id":1053,"label":"1.9-Linux内存调优化-分组","url":"yAju6j","children":[{"doc_id":1042,"label":"1.9-Linux内存调优化-文章","url":"BZvQ3u","DocHref":"/test/yAju6j/BZvQ3u"}]},{"group_id":1054,"label":"1.8-Linux SELinux安全-分组","url":"beiABz","children":[{"doc_id":1043,"label":"1.8-Linux SELinux安全-文章","url":"UB7nay","DocHref":"/test/beiABz/UB7nay"}]}]},{"group_id":1055,"label":"1.7-Linux iptables及浅说tcp ip-分组","url":"3Inuem","children":[{"doc_id":1044,"label":"1.7-Linux iptables及浅说tcp ip-文章","url":"qQNzaq","DocHref":"/test/3Inuem/qQNzaq"},{"group_id":1056,"label":"1.6-Linux yum包管理器-分组","url":"aiiQFf","children":[{"doc_id":1045,"label":"1.6-Linux yum包管理器-文章","url":"Yreiua","DocHref":"/test/aiiQFf/Yreiua"}]},{"group_id":1057,"label":"1.5-Linux vim编辑器及文件查找-分组","url":"uEjm63","children":[{"doc_id":1046,"label":"1.5-Linux vim编辑器及文件查找-文章","url":"EVZVra","DocHref":"/test/uEjm63/EVZVra"}]}]},{"group_id":1058,"label":"1.4-Linux权限模型-分组","url":"meiqie","children":[{"doc_id":1047,"label":"1.4-Linux权限模型-文章","url":"6BRr2m","DocHref":"/test/meiqie/6BRr2m"},{"group_id":1059,"label":"1.3-Linux文件系统详解-分组","url":"Mf6jqm","children":[{"doc_id":1048,"label":"1.3-Linux文件系统详解-文章","url":"VryUR3","DocHref":"/test/Mf6jqm/VryUR3"},{"group_id":1060,"label":"1.2-Linux系统启动及内核设计风格-分组","url":"Q3QZjm","children":[{"doc_id":1049,"label":"1.2-Linux系统启动及内核设计风格-文章","url":"iIzMV3","DocHref":"/test/Q3QZjm/iIzMV3"}]}]}]},{"group_id":1061,"label":"1.1-Linux发展现状-分组","url":"jAN7Rn","children":[{"doc_id":1050,"label":"1.1-Linux发展现状-文章","url":"eMfABz","DocHref":"/test/jAN7Rn/eMfABz"},{"group_id":1062,"label":"1.0-Linux源起-分组","url":"mauEjq","children":[{"doc_id":1051,"label":"1.0-Linux源起-文章","url":"B3mMje","DocHref":"/test/mauEjq/B3mMje"}]}]}]}').result


    this.kbInfo.kbName = this.$route.params.kbName
    this.kbInfo.docGrpShortUrl = this.$route.params.docGrpShortUrl
    this.kbInfo.docShortUrl = this.$route.params.docShortUrl

    // alert("123")
    this.content = this.contents[this.$route.params.docShortUrl]
    //console.log(this.content)
    //alert(this.content)
  },
  methods: {
    handleNodeClick: function (data) {
      let kbName = this.kbInfo.kbName
      let groupShortUrl = this.getParentShortUrl(data.url, this.docInfo)
      //alert(groupShortUrl)
      if (groupShortUrl !== undefined) {
        this.$router.push("/" + kbName + "/" + groupShortUrl + "/" + data.url)
      } else {
        this.$router.push("/" + kbName + "/" + data.url)
      }

    },
    getParentShortUrl: function (sonUrl, par) {
      //console.log(sonUrl, par, par.length)
      if (par.length === undefined) {
        for (let j = 0; j < par.children.length; j++) {
          //console.log(j, sonUrl, par.children[j])
          if (par.children[j].url === sonUrl) {
            return par.url
          }
          if (par.children[j].children !== undefined) {
            let result = this.getParentShortUrl(sonUrl, par.children[j])
            //alert("res" + result)
            if (result !== undefined) {
              return result
            }
          }

        }
      }

      for (let i = 0; i < par.length; i++) {
        //console.log(i,par[i])
        for (let j = 0; j < par[i].children.length; j++) {
          //console.log(j,par[i].children[j])
          if (par[i].children[j].url === sonUrl) {
            return par[i].url
          }
          if (par[i].children[j].children !== undefined) {
            //console.log(sonUrl,par[i].children[j])
            // console.log(this.getParentShortUrl(sonUrl, par[i].children[j]))
            let result = this.getParentShortUrl(sonUrl, par[i].children[j])
            if (result !== undefined) {
              return result
            }
          }

        }
      }
    }

  }
}
</script>

<style>
.is-current > .el-tree-node__content {
  color: orange !important;
}

</style>
